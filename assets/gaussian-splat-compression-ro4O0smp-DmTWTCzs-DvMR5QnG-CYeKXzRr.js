var Hr=Object.create,ar=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,Yr=Object.getOwnPropertyNames,Qr=Object.getPrototypeOf,Zr=Object.prototype.hasOwnProperty,Xr=(r,e,n)=>e in r?ar(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,H=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),dr=(r,e)=>{for(var n in e)ar(r,n,{get:e[n],enumerable:!0})},Kr=(r,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Yr(e))!Zr.call(r,a)&&a!==n&&ar(r,a,{get:()=>e[a],enumerable:!(s=Wr(e,a))||s.enumerable});return r},P=(r,e,n)=>(n=r!=null?Hr(Qr(r)):{},Kr(ar(n,"default",{value:r,enumerable:!0}),r)),T=(r,e,n)=>(Xr(r,typeof e!="symbol"?e+"":e,n),n),Jr=H((r,e)=>{function n(s){for(var a=new Array(s),i=0;i<s;++i)a[i]=i;return a}e.exports=n}),re=H((r,e)=>{e.exports=function(a){return a!=null&&(n(a)||s(a)||!!a._isBuffer)};function n(a){return!!a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function s(a){return typeof a.readFloatLE=="function"&&typeof a.slice=="function"&&n(a.slice(0,0))}}),rr=H((r,e)=>{var n=Jr(),s=re(),a=typeof Float64Array<"u";function i(d,l){return d[0]-l[0]}function t(){var d=this.stride,l=new Array(d.length),c;for(c=0;c<l.length;++c)l[c]=[Math.abs(d[c]),c];l.sort(i);var p=new Array(l.length);for(c=0;c<p.length;++c)p[c]=l[c][1];return p}function o(d,l){var c=["View",l,"d",d].join("");l<0&&(c="View_Nil"+d);var p=d==="generic";if(l===-1){var g="function "+c+"(a){this.data=a;};var proto="+c+".prototype;proto.dtype='"+d+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+c+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+c+"(a){return new "+c+"(a);}",z=new Function(g);return z()}else if(l===0){var g="function "+c+"(a,d) {this.data = a;this.offset = d};var proto="+c+".prototype;proto.dtype='"+d+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+c+"_copy() {return new "+c+"(this.data,this.offset)};proto.pick=function "+c+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+c+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+c+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+c+"(a,b,c,d){return new "+c+"(a,d)}",z=new Function("TrivialArray",g);return z(u[d][0])}var g=["'use strict'"],y=n(l),m=y.map(function(k){return"i"+k}),_="this.offset+"+y.map(function(k){return"this.stride["+k+"]*i"+k}).join("+"),b=y.map(function(k){return"b"+k}).join(","),M=y.map(function(k){return"c"+k}).join(",");g.push("function "+c+"(a,"+b+","+M+",d){this.data=a","this.shape=["+b+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+c+".prototype","proto.dtype='"+d+"'","proto.dimension="+l),g.push("Object.defineProperty(proto,'size',{get:function "+c+"_size(){return "+y.map(function(k){return"this.shape["+k+"]"}).join("*"),"}})"),l===1?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),l<4?(g.push("function "+c+"_order(){"),l===2?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):l===3&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+c+"_set("+m.join(",")+",v){"),p?g.push("return this.data.set("+_+",v)}"):g.push("return this.data["+_+"]=v}"),g.push("proto.get=function "+c+"_get("+m.join(",")+"){"),p?g.push("return this.data.get("+_+")}"):g.push("return this.data["+_+"]}"),g.push("proto.index=function "+c+"_index(",m.join(),"){return "+_+"}"),g.push("proto.hi=function "+c+"_hi("+m.join(",")+"){return new "+c+"(this.data,"+y.map(function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")}).join(",")+","+y.map(function(k){return"this.stride["+k+"]"}).join(",")+",this.offset)}");var x=y.map(function(k){return"a"+k+"=this.shape["+k+"]"}),w=y.map(function(k){return"c"+k+"=this.stride["+k+"]"});g.push("proto.lo=function "+c+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+w.join(","));for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"c"+k}).join(",")+",b)}"),g.push("proto.step=function "+c+"_step("+m.join(",")+"){var "+y.map(function(k){return"a"+k+"=this.shape["+k+"]"}).join(",")+","+y.map(function(k){return"b"+k+"=this.stride["+k+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"b"+k}).join(",")+",c)}");for(var A=new Array(l),S=new Array(l),v=0;v<l;++v)A[v]="a[i"+v+"]",S[v]="b[i"+v+"]";g.push("proto.transpose=function "+c+"_transpose("+m+"){"+m.map(function(k,D){return k+"=("+k+"===undefined?"+D+":"+k+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+c+"(this.data,"+A.join(",")+","+S.join(",")+",this.offset)}"),g.push("proto.pick=function "+c+"_pick("+m+"){var a=[],b=[],c=this.offset");for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+c+"(data,shape,stride,offset){return new "+c+"(data,"+y.map(function(k){return"shape["+k+"]"}).join(",")+","+y.map(function(k){return"stride["+k+"]"}).join(",")+",offset)}");var z=new Function("CTOR_LIST","ORDER",g.join(`
`));return z(u[d],t)}function h(d){if(s(d))return"buffer";if(a)switch(Object.prototype.toString.call(d)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(d)?"array":"generic"}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function f(d,l,c,p){if(d===void 0){var M=u.array[0];return M([])}else typeof d=="number"&&(d=[d]);l===void 0&&(l=[d.length]);var g=l.length;if(c===void 0){c=new Array(g);for(var y=g-1,m=1;y>=0;--y)c[y]=m,m*=l[y]}if(p===void 0){p=0;for(var y=0;y<g;++y)c[y]<0&&(p-=(l[y]-1)*c[y])}for(var _=h(d),b=u[_];b.length<=g+1;)b.push(o(_,b.length-1));var M=b[g+1];return M(d,l,c,p)}e.exports=f}),ee=H((r,e)=>{function n(i,t){for(var o=1,h=i.length,u=i[0],f=i[0],d=1;d<h;++d)if(f=u,u=i[d],t(u,f)){if(d===o){o++;continue}i[o++]=u}return i.length=o,i}function s(i){for(var t=1,o=i.length,h=i[0],u=i[0],f=1;f<o;++f,u=h)if(u=h,h=i[f],h!==u){if(f===t){t++;continue}i[t++]=h}return i.length=t,i}function a(i,t,o){return i.length===0?i:t?(o||i.sort(t),n(i,t)):(o||i.sort(),s(i))}e.exports=a}),ne=H((r,e)=>{var n=ee();function s(u,f,d){var l=u.length,c=f.arrayArgs.length,p=f.indexArgs.length>0,g=[],y=[],m=0,_=0,b,M;for(b=0;b<l;++b)y.push(["i",b,"=0"].join(""));for(M=0;M<c;++M)for(b=0;b<l;++b)_=m,m=u[b],b===0?y.push(["d",M,"s",b,"=t",M,"p",m].join("")):y.push(["d",M,"s",b,"=(t",M,"p",m,"-s",_,"*t",M,"p",_,")"].join(""));for(y.length>0&&g.push("var "+y.join(",")),b=l-1;b>=0;--b)m=u[b],g.push(["for(i",b,"=0;i",b,"<s",m,";++i",b,"){"].join(""));for(g.push(d),b=0;b<l;++b){for(_=m,m=u[b],M=0;M<c;++M)g.push(["p",M,"+=d",M,"s",b].join(""));p&&(b>0&&g.push(["index[",_,"]-=s",_].join("")),g.push(["++index[",m,"]"].join(""))),g.push("}")}return g.join(`
`)}function a(u,f,d,l){for(var c=f.length,p=d.arrayArgs.length,g=d.blockSize,y=d.indexArgs.length>0,m=[],_=0;_<p;++_)m.push(["var offset",_,"=p",_].join(""));for(var _=u;_<c;++_)m.push(["for(var j"+_+"=SS[",f[_],"]|0;j",_,">0;){"].join("")),m.push(["if(j",_,"<",g,"){"].join("")),m.push(["s",f[_],"=j",_].join("")),m.push(["j",_,"=0"].join("")),m.push(["}else{s",f[_],"=",g].join("")),m.push(["j",_,"-=",g,"}"].join("")),y&&m.push(["index[",f[_],"]=j",_].join(""));for(var _=0;_<p;++_){for(var b=["offset"+_],M=u;M<c;++M)b.push(["j",M,"*t",_,"p",f[M]].join(""));m.push(["p",_,"=(",b.join("+"),")"].join(""))}m.push(s(f,d,l));for(var _=u;_<c;++_)m.push("}");return m.join(`
`)}function i(u){for(var f=0,d=u[0].length;f<d;){for(var l=1;l<u.length;++l)if(u[l][f]!==u[0][f])return f;++f}return f}function t(u,f,d){for(var l=u.body,c=[],p=[],g=0;g<u.args.length;++g){var y=u.args[g];if(!(y.count<=0)){var m=new RegExp(y.name,"g"),_="",b=f.arrayArgs.indexOf(g);switch(f.argTypes[g]){case"offset":var M=f.offsetArgIndex.indexOf(g),x=f.offsetArgs[M];b=x.array,_="+q"+M;case"array":_="p"+b+_;var w="l"+g,v="a"+b;if(f.arrayBlockIndices[b]===0)y.count===1?d[b]==="generic"?y.lvalue?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),p.push([v,".set(",_,",",w,")"].join(""))):l=l.replace(m,[v,".get(",_,")"].join("")):l=l.replace(m,[v,"[",_,"]"].join("")):d[b]==="generic"?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),y.lvalue&&p.push([v,".set(",_,",",w,")"].join(""))):(c.push(["var ",w,"=",v,"[",_,"]"].join("")),l=l.replace(m,w),y.lvalue&&p.push([v,"[",_,"]=",w].join("")));else{for(var A=[y.name],S=[_],z=0;z<Math.abs(f.arrayBlockIndices[b]);z++)A.push("\\s*\\[([^\\]]+)\\]"),S.push("$"+(z+1)+"*t"+b+"b"+z);if(m=new RegExp(A.join(""),"g"),_=S.join("+"),d[b]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");l=l.replace(m,[v,"[",_,"]"].join(""))}break;case"scalar":l=l.replace(m,"Y"+f.scalarArgs.indexOf(g));break;case"index":l=l.replace(m,"index");break;case"shape":l=l.replace(m,"shape");break}}}return[c.join(`
`),l,p.join(`
`)].join(`
`).trim()}function o(u){for(var f=new Array(u.length),d=!0,l=0;l<u.length;++l){var c=u[l],p=c.match(/\d+/);p?p=p[0]:p="",c.charAt(0)===0?f[l]="u"+c.charAt(1)+p:f[l]=c.charAt(0)+p,l>0&&(d=d&&f[l]===f[l-1])}return d?f[0]:f.join("")}function h(u,f){for(var d=f[1].length-Math.abs(u.arrayBlockIndices[0])|0,l=new Array(u.arrayArgs.length),c=new Array(u.arrayArgs.length),p=0;p<u.arrayArgs.length;++p)c[p]=f[2*p],l[p]=f[2*p+1];for(var g=[],y=[],m=[],_=[],b=[],p=0;p<u.arrayArgs.length;++p){u.arrayBlockIndices[p]<0?(m.push(0),_.push(d),g.push(d),y.push(d+u.arrayBlockIndices[p])):(m.push(u.arrayBlockIndices[p]),_.push(u.arrayBlockIndices[p]+d),g.push(0),y.push(u.arrayBlockIndices[p]));for(var M=[],x=0;x<l[p].length;x++)m[p]<=l[p][x]&&l[p][x]<_[p]&&M.push(l[p][x]-m[p]);b.push(M)}for(var w=["SS"],v=["'use strict'"],A=[],x=0;x<d;++x)A.push(["s",x,"=SS[",x,"]"].join(""));for(var p=0;p<u.arrayArgs.length;++p){w.push("a"+p),w.push("t"+p),w.push("p"+p);for(var x=0;x<d;++x)A.push(["t",p,"p",x,"=t",p,"[",m[p]+x,"]"].join(""));for(var x=0;x<Math.abs(u.arrayBlockIndices[p]);++x)A.push(["t",p,"b",x,"=t",p,"[",g[p]+x,"]"].join(""))}for(var p=0;p<u.scalarArgs.length;++p)w.push("Y"+p);if(u.shapeArgs.length>0&&A.push("shape=SS.slice(0)"),u.indexArgs.length>0){for(var S=new Array(d),p=0;p<d;++p)S[p]="0";A.push(["index=[",S.join(","),"]"].join(""))}for(var p=0;p<u.offsetArgs.length;++p){for(var z=u.offsetArgs[p],k=[],x=0;x<z.offset.length;++x)z.offset[x]!==0&&(z.offset[x]===1?k.push(["t",z.array,"p",x].join("")):k.push([z.offset[x],"*t",z.array,"p",x].join("")));k.length===0?A.push("q"+p+"=0"):A.push(["q",p,"=",k.join("+")].join(""))}var D=n([].concat(u.pre.thisVars).concat(u.body.thisVars).concat(u.post.thisVars));A=A.concat(D),A.length>0&&v.push("var "+A.join(","));for(var p=0;p<u.arrayArgs.length;++p)v.push("p"+p+"|=0");u.pre.body.length>3&&v.push(t(u.pre,u,c));var F=t(u.body,u,c),q=i(b);q<d?v.push(a(q,b[0],u,F)):v.push(s(b[0],u,F)),u.post.body.length>3&&v.push(t(u.post,u,c)),u.debug&&console.log("-----Generated cwise routine for ",f,`:
`+v.join(`
`)+`
----------`);var E=[u.funcName||"unnamed","_cwise_loop_",l[0].join("s"),"m",q,o(c)].join(""),W=new Function(["function ",E,"(",w.join(","),"){",v.join(`
`),"} return ",E].join(""));return W()}e.exports=h}),se=H((r,e)=>{var n=ne();function s(a){var i=["'use strict'","var CACHED={}"],t=[],o=a.funcName+"_cwise_thunk";i.push(["return function ",o,"(",a.shimArgs.join(","),"){"].join(""));for(var h=[],u=[],f=[["array",a.arrayArgs[0],".shape.slice(",Math.max(0,a.arrayBlockIndices[0]),a.arrayBlockIndices[0]<0?","+a.arrayBlockIndices[0]+")":")"].join("")],d=[],l=[],c=0;c<a.arrayArgs.length;++c){var p=a.arrayArgs[c];t.push(["t",p,"=array",p,".dtype,","r",p,"=array",p,".order"].join("")),h.push("t"+p),h.push("r"+p),u.push("t"+p),u.push("r"+p+".join()"),f.push("array"+p+".data"),f.push("array"+p+".stride"),f.push("array"+p+".offset|0"),c>0&&(d.push("array"+a.arrayArgs[0]+".shape.length===array"+p+".shape.length+"+(Math.abs(a.arrayBlockIndices[0])-Math.abs(a.arrayBlockIndices[c]))),l.push("array"+a.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[0])+"]===array"+p+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[c])+"]"))}a.arrayArgs.length>1&&(i.push("if (!("+d.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),i.push("for(var shapeIndex=array"+a.arrayArgs[0]+".shape.length-"+Math.abs(a.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),i.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),i.push("}"));for(var c=0;c<a.scalarArgs.length;++c)f.push("scalar"+a.scalarArgs[c]);t.push(["type=[",u.join(","),"].join()"].join("")),t.push("proc=CACHED[type]"),i.push("var "+t.join(",")),i.push(["if(!proc){","CACHED[type]=proc=compile([",h.join(","),"])}","return proc(",f.join(","),")}"].join("")),a.debug&&console.log(`-----Generated thunk:
`+i.join(`
`)+`
----------`);var g=new Function("compile",i.join(`
`));return g(n.bind(void 0,a))}e.exports=s}),ae=H((r,e)=>{var n=se();function s(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function a(i){var t=new s;t.pre=i.pre,t.body=i.body,t.post=i.post;var o=i.args.slice(0);t.argTypes=o;for(var h=0;h<o.length;++h){var u=o[h];if(u==="array"||typeof u=="object"&&u.blockIndices){if(t.argTypes[h]="array",t.arrayArgs.push(h),t.arrayBlockIndices.push(u.blockIndices?u.blockIndices:0),t.shimArgs.push("array"+h),h<t.pre.args.length&&t.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array args");if(h<t.post.args.length&&t.post.args[h].count>0)throw new Error("cwise: post() block may not reference array args")}else if(u==="scalar")t.scalarArgs.push(h),t.shimArgs.push("scalar"+h);else if(u==="index"){if(t.indexArgs.push(h),h<t.pre.args.length&&t.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array index");if(h<t.body.args.length&&t.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array index");if(h<t.post.args.length&&t.post.args[h].count>0)throw new Error("cwise: post() block may not reference array index")}else if(u==="shape"){if(t.shapeArgs.push(h),h<t.pre.args.length&&t.pre.args[h].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(h<t.body.args.length&&t.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array shape");if(h<t.post.args.length&&t.post.args[h].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof u=="object"&&u.offset)t.argTypes[h]="offset",t.offsetArgs.push({array:u.array,offset:u.offset}),t.offsetArgIndex.push(h);else throw new Error("cwise: Unknown argument type "+o[h])}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>o.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>o.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>o.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!i.printCode||!!i.debug,t.funcName=i.funcName||"cwise",t.blockSize=i.blockSize||64,n(t)}e.exports=a}),er=H(r=>{var e=ae(),n={body:"",args:[],thisVars:[],localVars:[]};function s(l){if(!l)return n;for(var c=0;c<l.args.length;++c){var p=l.args[c];c===0?l.args[c]={name:p,lvalue:!0,rvalue:!!l.rvalue,count:l.count||1}:l.args[c]={name:p,lvalue:!1,rvalue:!0,count:1}}return l.thisVars||(l.thisVars=[]),l.localVars||(l.localVars=[]),l}function a(l){return e({args:l.args,pre:s(l.pre),body:s(l.body),post:s(l.proc),funcName:l.funcName})}function i(l){for(var c=[],p=0;p<l.args.length;++p)c.push("a"+p);var g=new Function("P",["return function ",l.funcName,"_ndarrayops(",c.join(","),") {P(",c.join(","),");return a0}"].join(""));return g(a(l))}var t={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var l in t){var c=t[l];r[l]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),r[l+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+c+"=b"},rvalue:!0,funcName:l+"eq"}),r[l+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),r[l+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+c+"=s"},rvalue:!0,funcName:l+"seq"})}})();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var l in o){var c=o[l];r[l]=i({args:["array","array"],body:{args:["a","b"],body:"a="+c+"b"},funcName:l}),r[l+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+c+"a"},rvalue:!0,count:2,funcName:l+"eq"})}})();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var l in h){var c=h[l];r[l]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),r[l+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),r[l+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+c+"b"},rvalue:!0,count:2,funcName:l+"eq"}),r[l+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+c+"s"},rvalue:!0,count:2,funcName:l+"seq"})}})();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var l=0;l<u.length;++l){var c=u[l];r[c]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:c}),r[c+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"})}})();var f=["max","min","atan2","pow"];(function(){for(var l=0;l<f.length;++l){var c=f[l];r[c]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c}),r[c+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c+"s"}),r[c+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"}),r[c+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"seq"})}})();var d=["atan2","pow"];(function(){for(var l=0;l<d.length;++l){var c=d[l];r[c+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"op"}),r[c+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"ops"}),r[c+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opeq"}),r[c+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opseq"})}})(),r.any=e({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),r.all=e({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),r.sum=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),r.prod=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),r.norm2squared=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),r.norm2=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),r.norminf=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),r.norm1=e({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),r.sup=e({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.inf=e({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),r.argmin=e({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.argmax=e({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),r.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),r.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),r.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),r.equals=e({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),$=P(rr()),R=P(er()),U=P(rr()),j=P(er()),sr=class{constructor(r,e,n){this._dataNormalized=r,this._minD=e,this._maxD=n}static createFromUnnormalized(r){let e=j.sup(r),n=j.inf(r),s=(0,U.default)(new Float32Array(r.size),r.shape),a=e-n;return a<1e-4?j.assigns(s,0):(j.subs(s,r,n),j.divs(s,s,a)),new sr(s,n,e)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let r=(0,U.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return j.muls(r,this._dataNormalized,this._maxD-this._minD),j.adds(r,r,this._minD),r}},B=class{constructor(r,e){this._quantized=r,this._method=e}get quantized(){return this._quantized}static maxIntBits(r){return 2**r-1}static fromNormalized(r,e){let n=r.data,s;if(e==="norm8x"){let a=B.maxIntBits(8),i=(0,U.default)(new Float32Array(n.size),n.shape);j.muls(i,n,a),j.roundeq(i),s=(0,U.default)(new Uint8Array(i.data),n.shape)}else if(e==="norm565"){let a=(0,U.default)(new Float32Array(n.size),n.shape);j.assign(a,n),j.mulseq(a.pick(null,0),B.maxIntBits(5)),j.mulseq(a.pick(null,1),B.maxIntBits(6)),j.mulseq(a.pick(null,2),B.maxIntBits(5)),j.roundeq(a);let i=(0,U.default)(new Uint16Array(a.data),n.shape),t=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),o=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);j.lshifts(t,i.pick(null,0),11),j.lshifts(o,i.pick(null,1),5),j.boreq(t,o),j.boreq(t,i.pick(null,2)),s=t}else{let a=(0,U.default)(new Float32Array(n.size),n.shape);j.assign(a,n),j.mulseq(a.pick(null,0),B.maxIntBits(11)),j.mulseq(a.pick(null,1),B.maxIntBits(10)),j.mulseq(a.pick(null,2),B.maxIntBits(11)),j.roundeq(a);let i=(0,U.default)(new Uint32Array(a.data),n.shape),t=(0,U.default)(new Uint32Array(n.shape[0]),[n.shape[0]]),o=(0,U.default)(new Uint32Array(n.shape[0]),[n.shape[0]]);j.lshifts(t,i.pick(null,0),21),j.lshifts(o,i.pick(null,1),11),j.boreq(t,o),j.boreq(t,i.pick(null,2)),s=t}return new B(s,e)}dequantize(r,e){let n=this._method,s,a=this._quantized;if(n==="norm8x"){let i=B.maxIntBits(8);s=(0,U.default)(new Float32Array(a.size),a.shape),j.muls(s,a,1/i)}else if(n==="norm565"){let i=(0,U.default)(new Uint8Array(a.shape[0]),[a.shape[0]]),t=(0,U.default)(new Uint8Array(a.shape[0]),[a.shape[0]]),o=(0,U.default)(new Uint8Array(a.shape[0]),[a.shape[0]]);j.rrshifts(i,a,11),j.rrshifts(t,a,5),j.bandseq(t,B.maxIntBits(6)),j.bands(o,a,B.maxIntBits(5)),s=(0,U.default)(new Float32Array(a.shape[0]*3),[a.shape[0],3]),j.muls(s.pick(null,0),i,1/B.maxIntBits(5)),j.muls(s.pick(null,1),t,1/B.maxIntBits(6)),j.muls(s.pick(null,2),o,1/B.maxIntBits(5))}else{let i=(0,U.default)(new Uint16Array(a.shape[0]),[a.shape[0]]),t=(0,U.default)(new Uint16Array(a.shape[0]),[a.shape[0]]),o=(0,U.default)(new Uint16Array(a.shape[0]),[a.shape[0]]);j.rrshifts(i,a,21),j.rrshifts(t,a,11),j.bandseq(t,B.maxIntBits(10)),j.bands(o,a,B.maxIntBits(11)),s=(0,U.default)(new Float32Array(a.shape[0]*3),[a.shape[0],3]),j.muls(s.pick(null,0),i,1/B.maxIntBits(11)),j.muls(s.pick(null,1),t,1/B.maxIntBits(10)),j.muls(s.pick(null,2),o,1/B.maxIntBits(11))}return new sr(s,r,e)}},N=class{constructor(r,e,n,s,a,i=!1){this._quantized=r,this._minMaxMatrix=e,this._chunkSize=n,this._quantizationMethod=s,this._variableChunkSize=a,this._isDynamicChunks=i}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(r){let e=r.length,n=this.minmaxMatrix.shape[0]-e,s=(0,$.default)(new Float32Array(n*2),[n,2]),a=0,i=n,t=0,o=this.minmaxMatrix.shape[0];for(let h=0;h<r.length;h++)o=r[h],i=o-t+a,i>a&&R.assign(s.hi(i,2).lo(a,0),this.minmaxMatrix.hi(o,2).lo(t,0)),a=i,t=o+1;return a<n&&R.assign(s.lo(a,0),this.minmaxMatrix.lo(t,0)),s}_createPrunedQuantized(r){let e=r.length,n=this.quantized.shape[0]-e,s=this._quantizationMethod,a,i;if(s==="norm8x"){i=this._quantized.shape[1];let f=i?n*i:n;a=(0,$.default)(new Uint8Array(f),i?[n,i]:[n,1])}else s==="norm565"?a=(0,$.default)(new Uint16Array(n),[n]):a=(0,$.default)(new Uint32Array(n),[n]);let t=0,o=n,h=0,u=a.shape[0];for(let f=0;f<r.length;f++)u=r[f],o=u-h+t,o>t&&(i?R.assign(a.hi(o,i).lo(t,0),this._quantized.hi(u,i).lo(h,0)):R.assign(a.hi(o).lo(t),this._quantized.hi(u).lo(h))),t=o,h=u+1;return t<n&&(i?R.assign(a.lo(t,0),this._quantized.lo(h,0)):R.assign(a.lo(t),this._quantized.lo(h))),a}pruneFeature(r,e,n){let s=this._createPrunedQuantized(r),a=this._createPrunedMinMax(e);return new N(s,a,this._chunkSize,this._quantizationMethod,n,!0)}static getRequiredNChunks(r,e){return Math.floor(r/e)}static fromArray(r,e,n){let s=r.shape[0],a=Math.floor(s/n),i=(0,$.default)(new Float32Array(a*2),[a,2],[2,1]),t;e==="norm8x"?t=(0,$.default)(new Uint8Array(r.size),r.shape):e==="norm565"?t=(0,$.default)(new Uint16Array(r.shape[0]),[r.shape[0]]):t=(0,$.default)(new Uint32Array(r.shape[0]),[r.shape[0]]);for(let o=0;o<a;o++){let h=o*n,u=o+1<a?(o+1)*n:s,f;r.shape.length>1?f=sr.createFromUnnormalized(r.hi(u,r.shape[1]).lo(h,0)):f=sr.createFromUnnormalized(r.hi(u).lo(h)),i.set(o,0,f.minD),i.set(o,1,f.maxD),t.shape.length>1?R.assign(t.hi(u,t.shape[1]).lo(h,0),B.fromNormalized(f,e).quantized):R.assign(t.hi(u).lo(h),B.fromNormalized(f,e).quantized)}return new N(t,i,n,e)}denormDequant(){let r=this._minMaxMatrix.shape[0],e=this._quantized,n=e.shape[0],s=this._quantizationMethod,a=this._chunkSize,i;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");i=this._variableChunkSize}let t;s==="norm8x"?t=(0,$.default)(new Float32Array(e.size),e.shape):t=(0,$.default)(new Float32Array(n*3),[n,3]);let o=0,h=a;for(let u=0;u<r;u++){let[f,d]=[this._minMaxMatrix.get(u,0),this._minMaxMatrix.get(u,1)];this._isDynamicChunks&&(h=i[u]);let l=u+1<r?o+h:n,c;e.shape.length>1?c=new B(e.hi(l,e.shape[1]).lo(o,0),s):c=new B(e.hi(l).lo(o),s),R.assign(t.hi(l,t.shape[1]).lo(o,0),c.dequantize(f,d).denormalize()),o=l}return t}static async fetchArrayBuffer(r){return await(await fetch(r,{mode:"cors"})).arrayBuffer()}},G=P(rr()),V=P(er()),ie="http://127.0.0.1:8000",K=P(rr()),C=P(er()),br=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function _r(r){return r<1e5?r<100?r<10?0:1:r<1e4?r<1e3?2:3:4:r<1e7?r<1e6?5:6:r<1e9?r<1e8?7:8:9}function vr(r,e){if(r===e)return 0;if(~~r===r&&~~e===e){if(r===0||e===0)return r<e?-1:1;if(r<0||e<0){if(e>=0)return-1;if(r>=0)return 1;r=-r,e=-e}let a=_r(r),i=_r(e),t=0;return a<i?(r*=br[i-a-1],e/=10,t=-1):a>i&&(e*=br[a-i-1],r/=10,t=1),r===e?t:r<e?-1:1}let n=String(r),s=String(e);return n===s?0:n<s?-1:1}function te(r){let e=0;for(;r>=32;)e|=r&1,r>>=1;return r+e}function Mr(r,e,n,s){let a=e+1;if(a===n)return 1;if(s(r[a++],r[e])<0){for(;a<n&&s(r[a],r[a-1])<0;)a++;oe(r,e,a)}else for(;a<n&&s(r[a],r[a-1])>=0;)a++;return a-e}function oe(r,e,n){for(n--;e<n;){let s=r[e];r[e++]=r[n],r[n--]=s}}function xr(r,e,n,s,a){for(s===e&&s++;s<n;s++){let i=r[s],t=e,o=s;for(;t<o;){let u=t+o>>>1;a(i,r[u])<0?o=u:t=u+1}let h=s-t;switch(h){case 3:r[t+3]=r[t+2];case 2:r[t+2]=r[t+1];case 1:r[t+1]=r[t];break;default:for(;h>0;)r[t+h]=r[t+h-1],h--}r[t]=i}}function ir(r,e,n,s,a,i){let t=0,o=0,h=1;if(i(r,e[n+a])>0){for(o=s-a;h<o&&i(r,e[n+a+h])>0;)t=h,h=(h<<1)+1,h<=0&&(h=o);h>o&&(h=o),t+=a,h+=a}else{for(o=a+1;h<o&&i(r,e[n+a-h])<=0;)t=h,h=(h<<1)+1,h<=0&&(h=o);h>o&&(h=o);let u=t;t=a-h,h=a-u}for(t++;t<h;){let u=t+(h-t>>>1);i(r,e[n+u])>0?t=u+1:h=u}return h}function tr(r,e,n,s,a,i){let t=0,o=0,h=1;if(i(r,e[n+a])<0){for(o=a+1;h<o&&i(r,e[n+a-h])<0;)t=h,h=(h<<1)+1,h<=0&&(h=o);h>o&&(h=o);let u=t;t=a-h,h=a-u}else{for(o=s-a;h<o&&i(r,e[n+a+h])>=0;)t=h,h=(h<<1)+1,h<=0&&(h=o);h>o&&(h=o),t+=a,h+=a}for(t++;t<h;){let u=t+(h-t>>>1);i(r,e[n+u])<0?h=u:t=u+1}return h}var he=class{constructor(r,e){T(this,"array",null),T(this,"compare",null),T(this,"minGallop",7),T(this,"length",0),T(this,"tmpStorageLength",256),T(this,"stackLength",0),T(this,"runStart",null),T(this,"runLength",null),T(this,"stackSize",0),this.array=r,this.compare=e,this.length=r.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(r,e){this.runStart[this.stackSize]=r,this.runLength[this.stackSize]=e,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let r=this.stackSize-2;if(r>=1&&this.runLength[r-1]<=this.runLength[r]+this.runLength[r+1]||r>=2&&this.runLength[r-2]<=this.runLength[r]+this.runLength[r-1])this.runLength[r-1]<this.runLength[r+1]&&r--;else if(this.runLength[r]>this.runLength[r+1])break;this.mergeAt(r)}}forceMergeRuns(){for(;this.stackSize>1;){let r=this.stackSize-2;r>0&&this.runLength[r-1]<this.runLength[r+1]&&r--,this.mergeAt(r)}}mergeAt(r){let e=this.compare,n=this.array,s=this.runStart[r],a=this.runLength[r],i=this.runStart[r+1],t=this.runLength[r+1];this.runLength[r]=a+t,r===this.stackSize-3&&(this.runStart[r+1]=this.runStart[r+2],this.runLength[r+1]=this.runLength[r+2]),this.stackSize--;let o=tr(n[i],n,s,a,0,e);s+=o,a-=o,a!==0&&(t=ir(n[s+a-1],n,i,t,t-1,e),t!==0&&(a<=t?this.mergeLow(s,a,i,t):this.mergeHigh(s,a,i,t)))}mergeLow(r,e,n,s){let a=this.compare,i=this.array,t=this.tmp,o=0;for(o=0;o<e;o++)t[o]=i[r+o];let h=0,u=n,f=r;if(i[f++]=i[u++],--s===0){for(o=0;o<e;o++)i[f+o]=t[h+o];return}if(e===1){for(o=0;o<s;o++)i[f+o]=i[u+o];i[f+s]=t[h];return}let d=this.minGallop;for(;;){let l=0,c=0,p=!1;do if(a(i[u],t[h])<0){if(i[f++]=i[u++],c++,l=0,--s===0){p=!0;break}}else if(i[f++]=t[h++],l++,c=0,--e===1){p=!0;break}while((l|c)<d);if(p)break;do{if(l=tr(i[u],t,h,e,0,a),l!==0){for(o=0;o<l;o++)i[f+o]=t[h+o];if(f+=l,h+=l,e-=l,e<=1){p=!0;break}}if(i[f++]=i[u++],--s===0){p=!0;break}if(c=ir(t[h],i,u,s,0,a),c!==0){for(o=0;o<c;o++)i[f+o]=i[u+o];if(f+=c,u+=c,s-=c,s===0){p=!0;break}}if(i[f++]=t[h++],--e===1){p=!0;break}d--}while(l>=7||c>=7);if(p)break;d<0&&(d=0),d+=2}if(this.minGallop=d,d<1&&(this.minGallop=1),e===1){for(o=0;o<s;o++)i[f+o]=i[u+o];i[f+s]=t[h]}else{if(e===0)throw new Error("mergeLow preconditions were not respected");for(o=0;o<e;o++)i[f+o]=t[h+o]}}mergeHigh(r,e,n,s){let a=this.compare,i=this.array,t=this.tmp,o=0;for(o=0;o<s;o++)t[o]=i[n+o];let h=r+e-1,u=s-1,f=n+s-1,d=0,l=0;if(i[f--]=i[h--],--e===0){for(d=f-(s-1),o=0;o<s;o++)i[d+o]=t[o];return}if(s===1){for(f-=e,h-=e,l=f+1,d=h+1,o=e-1;o>=0;o--)i[l+o]=i[d+o];i[f]=t[u];return}let c=this.minGallop;for(;;){let p=0,g=0,y=!1;do if(a(t[u],i[h])<0){if(i[f--]=i[h--],p++,g=0,--e===0){y=!0;break}}else if(i[f--]=t[u--],g++,p=0,--s===1){y=!0;break}while((p|g)<c);if(y)break;do{if(p=e-tr(t[u],i,r,e,e-1,a),p!==0){for(f-=p,h-=p,e-=p,l=f+1,d=h+1,o=p-1;o>=0;o--)i[l+o]=i[d+o];if(e===0){y=!0;break}}if(i[f--]=t[u--],--s===1){y=!0;break}if(g=s-ir(i[h],t,0,s,s-1,a),g!==0){for(f-=g,u-=g,s-=g,l=f+1,d=u+1,o=0;o<g;o++)i[l+o]=t[d+o];if(s<=1){y=!0;break}}if(i[f--]=i[h--],--e===0){y=!0;break}c--}while(p>=7||g>=7);if(y)break;c<0&&(c=0),c+=2}if(this.minGallop=c,c<1&&(this.minGallop=1),s===1){for(f-=e,h-=e,l=f+1,d=h+1,o=e-1;o>=0;o--)i[l+o]=i[d+o];i[f]=t[u]}else{if(s===0)throw new Error("mergeHigh preconditions were not respected");for(d=f-(s-1),o=0;o<s;o++)i[d+o]=t[o]}}};function ue(r,e,n,s){if(!Array.isArray(r))throw new TypeError("Can only sort arrays");e?typeof e!="function"&&(s=n,n=e,e=vr):e=vr,n||(n=0),s||(s=r.length);let a=s-n;if(a<2)return;let i=0;if(a<32){i=Mr(r,n,s,e),xr(r,n,s,n+i,e);return}let t=new he(r,e),o=te(a);do{if(i=Mr(r,n,s,e),i<o){let h=a;h>o&&(h=o),xr(r,n,n+h,n+i,e),i=h}t.pushRun(n,i),t.mergeRuns(),a-=i,n+=i}while(a!==0);t.forceMergeRuns()}function or(r){let e=(0,K.default)(new Int32Array(r.shape[0]),[r.shape[0]]),n=(0,K.default)(new Int32Array(r.shape[0]),[r.shape[0]]);return C.bands(e,r,1023),C.lshifts(n,e,16),C.bxoreq(e,n),C.bandseq(e,4278190335),C.lshifts(n,e,8),C.bxoreq(e,n),C.bandseq(e,50393103),C.lshifts(n,e,4),C.bxoreq(e,n),C.bandseq(e,51130563),C.lshifts(n,e,2),C.bxoreq(e,n),C.bandseq(e,153391689),e}function le(r){let e=or(r.pick(null,0)),n=or(r.pick(null,1));C.lshiftseq(n,1);let s=or(r.pick(null,2));return C.lshiftseq(s,2),C.boreq(e,n),C.boreq(e,s),e}function Z(r,e){if(r.shape[0]!==e.shape[0])throw new Error("wrong length");let n=(0,K.default)(new Float32Array(r.size),r.shape,r.stride,r.offset);for(let s=0;s<e.shape[0];s++){let a=e.get(s);if(r.shape.length>1)for(let i=0;i<r.shape[1];i++)n.set(s,i,r.get(a,i));else n.set(s,r.get(a))}return n}function ce(r){let e=C.sup(r),n=C.inf(r),s=1e3/Math.min(1e3,e-n),a=(0,K.default)(new Float32Array(r.data),r.shape);C.mulseq(a,s);let i=(0,K.default)(new Int32Array(a.data),r.shape),t=le(i),o=Array.from(t.data).map((u,f)=>[u,f]);ue(o,(u,f)=>u[0]-f[0]);let h=o.map(([u,f])=>f);return(0,K.default)(Uint32Array.from(h))}var Y=class{constructor(r,e,n,s,a,i,t,o,h,u){this.propertyDescs=r,this.format=e,this.nsplats=n,this.xyz=s,this.colors=a,this.harmonics=i,this.opacity=t,this.scaling=o,this.rotation=h,this.maxSHDegree=u}getPlyBinary(){let r=Y._generateHeaderString(this.propertyDescs,this.format,this.nsplats),e=new TextEncoder().encode(r),n=Object.keys(this.propertyDescs).length,s=(0,G.default)(new Float32Array(this.nsplats*n),[this.nsplats,n]);if(V.assign(s.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let t=0;t<this.harmonics.length;t++){let o=t*3;V.assign(s.pick(null,this.propertyDescs[`f_rest_${o}`].index),this.harmonics[t].pick(null,0)),V.assign(s.pick(null,this.propertyDescs[`f_rest_${o+1}`].index),this.harmonics[t].pick(null,1)),V.assign(s.pick(null,this.propertyDescs[`f_rest_${o+2}`].index),this.harmonics[t].pick(null,2))}let a=new Uint8Array(s.data.buffer),i=new Uint8Array(a.length+e.length);return i.set(e),i.set(a,e.length),i.buffer}save(r,e){let n=this.getPlyBinary(),s=new Blob([n],{type:"application/octet-stream"}),a=new File([s],r),i=new FormData;i.append("file",a),i.append("filename",r),i.append("basedir",e),fetch(`${ie}/push_file`,{method:"POST",body:i})}static async loadFile(r){return await(await fetch(r)).arrayBuffer()}mortonPositionSplatsSort(){let r=ce(this.xyz),e=Z(this.xyz,r),n=Z(this.colors,r),s=Z(this.opacity,r),a=Z(this.scaling,r),i=Z(this.rotation,r),t=[];for(let o=0;o<this.harmonics.length;o++)t.push(Z(this.harmonics[o],r));return new Y(this.propertyDescs,this.format,this.nsplats,e,n,t,s,a,i,this.maxSHDegree)}static _generateHeaderString(r,e,n){let s=`ply
format ${e.format} ${e.version}
element vertex ${n}`,a=Object.keys(r).length,i=Array(a);for(let t in r){let o=r[t];i[o.index]={name:t,dtype:o.dtype}}for(let t=0;t<i.length;t++)s=`${s}
property ${i[t].dtype} ${i[t].name}`;return`${s}
end_header
`}static fromArrayBuffer(r,e=3){let{splatCount:n,vertexData:s,propertiesDesc:a,format:i}=Y.decodeHeader(r),t=s.buffer.slice(s.byteOffset),o=Object.keys(a).length,h=(0,G.default)(new Float32Array(t),[n,o]),u=0,f={},d={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let b in a)if(a.hasOwnProperty(b)){let M=a[b].dtype;f[b]=u,u+=d[M]}let l=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(l.pick(null,0),h.pick(null,f.x/4)),V.assign(l.pick(null,1),h.pick(null,f.y/4)),V.assign(l.pick(null,2),h.pick(null,f.z/4));let c=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(c.pick(null,0),h.pick(null,f.scale_0/4)),V.assign(c.pick(null,1),h.pick(null,f.scale_1/4)),V.assign(c.pick(null,2),h.pick(null,f.scale_2/4));let p=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(p.pick(null,0),h.pick(null,f.f_dc_0/4)),V.assign(p.pick(null,1),h.pick(null,f.f_dc_1/4)),V.assign(p.pick(null,2),h.pick(null,f.f_dc_2/4));let g=(0,G.default)(new Float32Array(n*4),[n,4]);V.assign(g.pick(null,0),h.pick(null,f.rot_1/4)),V.assign(g.pick(null,1),h.pick(null,f.rot_2/4)),V.assign(g.pick(null,2),h.pick(null,f.rot_3/4)),V.assign(g.pick(null,3),h.pick(null,f.rot_0/4));for(let b=0;b<n;b++){let M=g.pick(b,null),x=Math.sqrt(M.get(0)**2+M.get(1)**2+M.get(2)**2+M.get(3)**2);V.divseq(M,x)}let y=(0,G.default)(new Float32Array(n*1),[n,1]);V.assign(y.pick(null,0),h.pick(null,f.opacity/4)),V.negeq(y),V.expeq(y),V.addseq(y,1),V.recipeq(y),V.mulseq(y,255);let m=(Math.min(Math.max(e,0),3)+1)**2-1,_=[];for(let b=0;b<m;b++){let M=(0,G.default)(new Float32Array(n*3),[n,3]),x=b*3;V.assign(M.pick(null,0),h.pick(null,f[`f_rest_${x}`]/4)),V.assign(M.pick(null,1),h.pick(null,f[`f_rest_${x+1}`]/4)),V.assign(M.pick(null,2),h.pick(null,f[`f_rest_${x+2}`]/4)),_.push(M)}return new Y(a,i,n,l,p,_,y,c,g,e)}static async fromPLYFile(r,e=3){let n=await Y.loadFile(r);return Y.fromArrayBuffer(n,e)}static decodeHeader(r){let e=new TextDecoder,n=0,s="",a=100;for(;;){if(n+a>=r.byteLength)throw new Error("End of file reached while searching for end of header");let l=new Uint8Array(r,n,a);s+=e.decode(l),n+=a;let c=n-a*2,p=new Uint8Array(r,Math.max(0,c),c>0?a*2:a);if(e.decode(p).includes("end_header"))break}let i=s.split(`
`),t=0,o={},h=0,u;for(let l=0;l<i.length;l++){let c=i[l].trim();if(c.startsWith("element vertex")){let p=c.match(/\d+/);p&&(t=parseInt(p[0]))}else if(c.startsWith("property")){let p=c.match(/(\w+)\s+(\w+)\s+(\w+)/);if(p){let g=p[2],y=p[3];o[y]={dtype:g,index:h},h++}}else if(c.startsWith("format")){let p=c.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);p&&(u={format:p[2],version:p[3]})}else if(c==="end_header")break}let f=s.indexOf("end_header")+10+1,d=new DataView(r,f);return{splatCount:t,vertexData:d,headerOffset:n,propertiesDesc:o,format:u}}},lr=class{constructor(r,e,n,s,a,i,t,o){this.config=r,this.xyz=e,this.scaling=n,this.color=s,this.opacity=a,this.harmonics=t,this.quaternion=i,this.variableChunkSize=o}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(r,e){let n=N.fromArray(r.xyz,e.xyz,e.chunkSize),s=N.fromArray(r.scaling,e.scaling,e.chunkSize),a=N.fromArray(r.colors,e.color,e.chunkSize),i=N.fromArray(r.opacity,e.opacity,e.chunkSize),t=N.fromArray(r.rotation,e.quaternion,e.chunkSize),o=r.harmonics,h=[];if(e.harmonics)for(let u=0;u<o.length;u++){let f=N.fromArray(o[u],e.harmonics,e.chunkSize);h.push(f)}return new lr(e,n,s,a,i,t,h)}_countIndexesInChunks(r){let e=[],n=this.nchunks,s=this.chunkSize,a=this.nsplats,i=N.getRequiredNChunks(a,s);if(n===i)for(let t=0;t<r.length;t++){let o=r[t],h=Math.floor(o/this.chunkSize);h in e?e[h].push(o):e[h]=[o]}else{let t=this.variableChunkSize,o={},h=0;for(let u=0;u<n;u++)o[u]=h,h+=t[u];for(let u=0;u<r.length;u++){let f=r[u],d=Math.min(Math.floor(f/s),n-1);for(;f>=o[d]+t[d];)d++;d in e?e[d].push(f):e[d]=[f]}}return e}pruneSplats(r){let e=this._countIndexesInChunks(r),n,s=[];return e.length>0&&(n=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),e.forEach((a,i)=>{n[i]-=a.length,n[i]<=0&&s.push(i)}),n=n.filter(a=>a>0)),new lr(this.config,this.xyz.pruneFeature(r,s,n),this.scaling.pruneFeature(r,s,n),this.color.pruneFeature(r,s,n),this.opacity.pruneFeature(r,s,n),this.quaternion.pruneFeature(r,s,n),this.harmonics?this.harmonics.map(a=>a.pruneFeature(r,s,this.variableChunkSize)):void 0,n)}static async loadConfig(r){return await(await fetch(r,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){var r;let e={format:"binary_little_endian",version:"1.0"},n={},s=0;if(n.x={dtype:"float",index:s},s++,n.y={dtype:"float",index:s},s++,n.z={dtype:"float",index:s},s++,n.f_dc_0={dtype:"float",index:s},s++,n.f_dc_1={dtype:"float",index:s},s++,n.f_dc_2={dtype:"float",index:s},s++,this.harmonics&&this.harmonics.length>0)for(let i=0;i<this.harmonics.length;i++)n[`f_rest_${i}`]={dtype:"float",index:s},s++,n[`f_rest_${i+1}`]={dtype:"float",index:s},s++,n[`f_rest_${i+2}`]={dtype:"float",index:s},s++;n.opacity={dtype:"float",index:s},s++,n.scale_0={dtype:"float",index:s},s++,n.scale_1={dtype:"float",index:s},s++,n.scale_2={dtype:"float",index:s},s++,n.rot_0={dtype:"float",index:s},s++,n.rot_1={dtype:"float",index:s},s++,n.rot_2={dtype:"float",index:s},s++,n.rot_3={dtype:"float",index:s},s++;let a=(r=this.harmonics)==null?void 0:r.map(i=>i.denormDequant());return new Y(n,e,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),a||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},X=P(rr()),O=P(er()),I=1e-6,L=typeof Float32Array<"u"?Float32Array:Array,hr=Math.random;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Q={};dr(Q,{add:()=>Be,adjoint:()=>ve,clone:()=>pe,copy:()=>de,create:()=>qr,determinant:()=>Me,equals:()=>Le,exactEquals:()=>Ce,frob:()=>Fe,fromMat2d:()=>je,fromMat4:()=>fe,fromQuat:()=>Ve,fromRotation:()=>qe,fromScaling:()=>ze,fromTranslation:()=>Ae,fromValues:()=>ye,identity:()=>me,invert:()=>_e,mul:()=>Ee,multiply:()=>zr,multiplyScalar:()=>Ne,multiplyScalarAndAdd:()=>Ue,normalFromMat4:()=>Se,projection:()=>Ie,rotate:()=>we,scale:()=>ke,set:()=>ge,str:()=>De,sub:()=>Oe,subtract:()=>jr,translate:()=>xe,transpose:()=>be});function qr(){var r=new L(9);return L!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function fe(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r}function pe(r){var e=new L(9);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function de(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function ye(r,e,n,s,a,i,t,o,h){var u=new L(9);return u[0]=r,u[1]=e,u[2]=n,u[3]=s,u[4]=a,u[5]=i,u[6]=t,u[7]=o,u[8]=h,u}function ge(r,e,n,s,a,i,t,o,h,u){return r[0]=e,r[1]=n,r[2]=s,r[3]=a,r[4]=i,r[5]=t,r[6]=o,r[7]=h,r[8]=u,r}function me(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function be(r,e){if(r===e){var n=e[1],s=e[2],a=e[5];r[1]=e[3],r[2]=e[6],r[3]=n,r[5]=e[7],r[6]=s,r[7]=a}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function _e(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=e[4],o=e[5],h=e[6],u=e[7],f=e[8],d=f*t-o*u,l=-f*i+o*h,c=u*i-t*h,p=n*d+s*l+a*c;return p?(p=1/p,r[0]=d*p,r[1]=(-f*s+a*u)*p,r[2]=(o*s-a*t)*p,r[3]=l*p,r[4]=(f*n-a*h)*p,r[5]=(-o*n+a*i)*p,r[6]=c*p,r[7]=(-u*n+s*h)*p,r[8]=(t*n-s*i)*p,r):null}function ve(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=e[4],o=e[5],h=e[6],u=e[7],f=e[8];return r[0]=t*f-o*u,r[1]=a*u-s*f,r[2]=s*o-a*t,r[3]=o*h-i*f,r[4]=n*f-a*h,r[5]=a*i-n*o,r[6]=i*u-t*h,r[7]=s*h-n*u,r[8]=n*t-s*i,r}function Me(r){var e=r[0],n=r[1],s=r[2],a=r[3],i=r[4],t=r[5],o=r[6],h=r[7],u=r[8];return e*(u*i-t*h)+n*(-u*a+t*o)+s*(h*a-i*o)}function zr(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=e[4],h=e[5],u=e[6],f=e[7],d=e[8],l=n[0],c=n[1],p=n[2],g=n[3],y=n[4],m=n[5],_=n[6],b=n[7],M=n[8];return r[0]=l*s+c*t+p*u,r[1]=l*a+c*o+p*f,r[2]=l*i+c*h+p*d,r[3]=g*s+y*t+m*u,r[4]=g*a+y*o+m*f,r[5]=g*i+y*h+m*d,r[6]=_*s+b*t+M*u,r[7]=_*a+b*o+M*f,r[8]=_*i+b*h+M*d,r}function xe(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=e[4],h=e[5],u=e[6],f=e[7],d=e[8],l=n[0],c=n[1];return r[0]=s,r[1]=a,r[2]=i,r[3]=t,r[4]=o,r[5]=h,r[6]=l*s+c*t+u,r[7]=l*a+c*o+f,r[8]=l*i+c*h+d,r}function we(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=e[4],h=e[5],u=e[6],f=e[7],d=e[8],l=Math.sin(n),c=Math.cos(n);return r[0]=c*s+l*t,r[1]=c*a+l*o,r[2]=c*i+l*h,r[3]=c*t-l*s,r[4]=c*o-l*a,r[5]=c*h-l*i,r[6]=u,r[7]=f,r[8]=d,r}function ke(r,e,n){var s=n[0],a=n[1];return r[0]=s*e[0],r[1]=s*e[1],r[2]=s*e[2],r[3]=a*e[3],r[4]=a*e[4],r[5]=a*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Ae(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=e[0],r[7]=e[1],r[8]=1,r}function qe(r,e){var n=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=n,r[2]=0,r[3]=-n,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function ze(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=e[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function je(r,e){return r[0]=e[0],r[1]=e[1],r[2]=0,r[3]=e[2],r[4]=e[3],r[5]=0,r[6]=e[4],r[7]=e[5],r[8]=1,r}function Ve(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=n+n,o=s+s,h=a+a,u=n*t,f=s*t,d=s*o,l=a*t,c=a*o,p=a*h,g=i*t,y=i*o,m=i*h;return r[0]=1-d-p,r[3]=f-m,r[6]=l+y,r[1]=f+m,r[4]=1-u-p,r[7]=c-g,r[2]=l-y,r[5]=c+g,r[8]=1-u-d,r}function Se(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=e[4],o=e[5],h=e[6],u=e[7],f=e[8],d=e[9],l=e[10],c=e[11],p=e[12],g=e[13],y=e[14],m=e[15],_=n*o-s*t,b=n*h-a*t,M=n*u-i*t,x=s*h-a*o,w=s*u-i*o,v=a*u-i*h,A=f*g-d*p,S=f*y-l*p,z=f*m-c*p,k=d*y-l*g,D=d*m-c*g,F=l*m-c*y,q=_*F-b*D+M*k+x*z-w*S+v*A;return q?(q=1/q,r[0]=(o*F-h*D+u*k)*q,r[1]=(h*z-t*F-u*S)*q,r[2]=(t*D-o*z+u*A)*q,r[3]=(a*D-s*F-i*k)*q,r[4]=(n*F-a*z+i*S)*q,r[5]=(s*z-n*D-i*A)*q,r[6]=(g*v-y*w+m*x)*q,r[7]=(y*M-p*v-m*b)*q,r[8]=(p*w-g*M+m*_)*q,r):null}function Ie(r,e,n){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/n,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function De(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function Fe(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function Be(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r}function jr(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r}function Ne(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r}function Ue(r,e,n,s){return r[0]=e[0]+n[0]*s,r[1]=e[1]+n[1]*s,r[2]=e[2]+n[2]*s,r[3]=e[3]+n[3]*s,r[4]=e[4]+n[4]*s,r[5]=e[5]+n[5]*s,r[6]=e[6]+n[6]*s,r[7]=e[7]+n[7]*s,r[8]=e[8]+n[8]*s,r}function Ce(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]}function Le(r,e){var n=r[0],s=r[1],a=r[2],i=r[3],t=r[4],o=r[5],h=r[6],u=r[7],f=r[8],d=e[0],l=e[1],c=e[2],p=e[3],g=e[4],y=e[5],m=e[6],_=e[7],b=e[8];return Math.abs(n-d)<=I*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-l)<=I*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(a-c)<=I*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-p)<=I*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(t-g)<=I*Math.max(1,Math.abs(t),Math.abs(g))&&Math.abs(o-y)<=I*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(h-m)<=I*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-_)<=I*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(f-b)<=I*Math.max(1,Math.abs(f),Math.abs(b))}var Ee=zr,Oe=jr,cr={};dr(cr,{add:()=>An,adjoint:()=>Ye,clone:()=>Pe,copy:()=>Te,create:()=>$e,determinant:()=>Qe,equals:()=>Vn,exactEquals:()=>jn,frob:()=>kn,fromQuat:()=>dn,fromQuat2:()=>un,fromRotation:()=>an,fromRotationTranslation:()=>Ir,fromRotationTranslationScale:()=>fn,fromRotationTranslationScaleOrigin:()=>pn,fromScaling:()=>sn,fromTranslation:()=>nn,fromValues:()=>Re,fromXRotation:()=>tn,fromYRotation:()=>on,fromZRotation:()=>hn,frustum:()=>yn,getRotation:()=>cn,getScaling:()=>Dr,getTranslation:()=>ln,identity:()=>Vr,invert:()=>We,lookAt:()=>Mn,mul:()=>Sn,multiply:()=>Sr,multiplyScalar:()=>qn,multiplyScalarAndAdd:()=>zn,ortho:()=>_n,orthoNO:()=>Br,orthoZO:()=>vn,perspective:()=>gn,perspectiveFromFieldOfView:()=>bn,perspectiveNO:()=>Fr,perspectiveZO:()=>mn,rotate:()=>Ke,rotateX:()=>Je,rotateY:()=>rn,rotateZ:()=>en,scale:()=>Xe,set:()=>Ge,str:()=>wn,sub:()=>In,subtract:()=>Nr,targetTo:()=>xn,translate:()=>Ze,transpose:()=>He});function $e(){var r=new L(16);return L!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Pe(r){var e=new L(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Te(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Re(r,e,n,s,a,i,t,o,h,u,f,d,l,c,p,g){var y=new L(16);return y[0]=r,y[1]=e,y[2]=n,y[3]=s,y[4]=a,y[5]=i,y[6]=t,y[7]=o,y[8]=h,y[9]=u,y[10]=f,y[11]=d,y[12]=l,y[13]=c,y[14]=p,y[15]=g,y}function Ge(r,e,n,s,a,i,t,o,h,u,f,d,l,c,p,g,y){return r[0]=e,r[1]=n,r[2]=s,r[3]=a,r[4]=i,r[5]=t,r[6]=o,r[7]=h,r[8]=u,r[9]=f,r[10]=d,r[11]=l,r[12]=c,r[13]=p,r[14]=g,r[15]=y,r}function Vr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function He(r,e){if(r===e){var n=e[1],s=e[2],a=e[3],i=e[6],t=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=i,r[11]=e[14],r[12]=a,r[13]=t,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function We(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=e[4],o=e[5],h=e[6],u=e[7],f=e[8],d=e[9],l=e[10],c=e[11],p=e[12],g=e[13],y=e[14],m=e[15],_=n*o-s*t,b=n*h-a*t,M=n*u-i*t,x=s*h-a*o,w=s*u-i*o,v=a*u-i*h,A=f*g-d*p,S=f*y-l*p,z=f*m-c*p,k=d*y-l*g,D=d*m-c*g,F=l*m-c*y,q=_*F-b*D+M*k+x*z-w*S+v*A;return q?(q=1/q,r[0]=(o*F-h*D+u*k)*q,r[1]=(a*D-s*F-i*k)*q,r[2]=(g*v-y*w+m*x)*q,r[3]=(l*w-d*v-c*x)*q,r[4]=(h*z-t*F-u*S)*q,r[5]=(n*F-a*z+i*S)*q,r[6]=(y*M-p*v-m*b)*q,r[7]=(f*v-l*M+c*b)*q,r[8]=(t*D-o*z+u*A)*q,r[9]=(s*z-n*D-i*A)*q,r[10]=(p*w-g*M+m*_)*q,r[11]=(d*M-f*w-c*_)*q,r[12]=(o*S-t*k-h*A)*q,r[13]=(n*k-s*S+a*A)*q,r[14]=(g*b-p*x-y*_)*q,r[15]=(f*x-d*b+l*_)*q,r):null}function Ye(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=e[4],o=e[5],h=e[6],u=e[7],f=e[8],d=e[9],l=e[10],c=e[11],p=e[12],g=e[13],y=e[14],m=e[15];return r[0]=o*(l*m-c*y)-d*(h*m-u*y)+g*(h*c-u*l),r[1]=-(s*(l*m-c*y)-d*(a*m-i*y)+g*(a*c-i*l)),r[2]=s*(h*m-u*y)-o*(a*m-i*y)+g*(a*u-i*h),r[3]=-(s*(h*c-u*l)-o*(a*c-i*l)+d*(a*u-i*h)),r[4]=-(t*(l*m-c*y)-f*(h*m-u*y)+p*(h*c-u*l)),r[5]=n*(l*m-c*y)-f*(a*m-i*y)+p*(a*c-i*l),r[6]=-(n*(h*m-u*y)-t*(a*m-i*y)+p*(a*u-i*h)),r[7]=n*(h*c-u*l)-t*(a*c-i*l)+f*(a*u-i*h),r[8]=t*(d*m-c*g)-f*(o*m-u*g)+p*(o*c-u*d),r[9]=-(n*(d*m-c*g)-f*(s*m-i*g)+p*(s*c-i*d)),r[10]=n*(o*m-u*g)-t*(s*m-i*g)+p*(s*u-i*o),r[11]=-(n*(o*c-u*d)-t*(s*c-i*d)+f*(s*u-i*o)),r[12]=-(t*(d*y-l*g)-f*(o*y-h*g)+p*(o*l-h*d)),r[13]=n*(d*y-l*g)-f*(s*y-a*g)+p*(s*l-a*d),r[14]=-(n*(o*y-h*g)-t*(s*y-a*g)+p*(s*h-a*o)),r[15]=n*(o*l-h*d)-t*(s*l-a*d)+f*(s*h-a*o),r}function Qe(r){var e=r[0],n=r[1],s=r[2],a=r[3],i=r[4],t=r[5],o=r[6],h=r[7],u=r[8],f=r[9],d=r[10],l=r[11],c=r[12],p=r[13],g=r[14],y=r[15],m=e*t-n*i,_=e*o-s*i,b=e*h-a*i,M=n*o-s*t,x=n*h-a*t,w=s*h-a*o,v=u*p-f*c,A=u*g-d*c,S=u*y-l*c,z=f*g-d*p,k=f*y-l*p,D=d*y-l*g;return m*D-_*k+b*z+M*S-x*A+w*v}function Sr(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=e[4],h=e[5],u=e[6],f=e[7],d=e[8],l=e[9],c=e[10],p=e[11],g=e[12],y=e[13],m=e[14],_=e[15],b=n[0],M=n[1],x=n[2],w=n[3];return r[0]=b*s+M*o+x*d+w*g,r[1]=b*a+M*h+x*l+w*y,r[2]=b*i+M*u+x*c+w*m,r[3]=b*t+M*f+x*p+w*_,b=n[4],M=n[5],x=n[6],w=n[7],r[4]=b*s+M*o+x*d+w*g,r[5]=b*a+M*h+x*l+w*y,r[6]=b*i+M*u+x*c+w*m,r[7]=b*t+M*f+x*p+w*_,b=n[8],M=n[9],x=n[10],w=n[11],r[8]=b*s+M*o+x*d+w*g,r[9]=b*a+M*h+x*l+w*y,r[10]=b*i+M*u+x*c+w*m,r[11]=b*t+M*f+x*p+w*_,b=n[12],M=n[13],x=n[14],w=n[15],r[12]=b*s+M*o+x*d+w*g,r[13]=b*a+M*h+x*l+w*y,r[14]=b*i+M*u+x*c+w*m,r[15]=b*t+M*f+x*p+w*_,r}function Ze(r,e,n){var s=n[0],a=n[1],i=n[2],t,o,h,u,f,d,l,c,p,g,y,m;return e===r?(r[12]=e[0]*s+e[4]*a+e[8]*i+e[12],r[13]=e[1]*s+e[5]*a+e[9]*i+e[13],r[14]=e[2]*s+e[6]*a+e[10]*i+e[14],r[15]=e[3]*s+e[7]*a+e[11]*i+e[15]):(t=e[0],o=e[1],h=e[2],u=e[3],f=e[4],d=e[5],l=e[6],c=e[7],p=e[8],g=e[9],y=e[10],m=e[11],r[0]=t,r[1]=o,r[2]=h,r[3]=u,r[4]=f,r[5]=d,r[6]=l,r[7]=c,r[8]=p,r[9]=g,r[10]=y,r[11]=m,r[12]=t*s+f*a+p*i+e[12],r[13]=o*s+d*a+g*i+e[13],r[14]=h*s+l*a+y*i+e[14],r[15]=u*s+c*a+m*i+e[15]),r}function Xe(r,e,n){var s=n[0],a=n[1],i=n[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ke(r,e,n,s){var a=s[0],i=s[1],t=s[2],o=Math.hypot(a,i,t),h,u,f,d,l,c,p,g,y,m,_,b,M,x,w,v,A,S,z,k,D,F,q,E;return o<I?null:(o=1/o,a*=o,i*=o,t*=o,h=Math.sin(n),u=Math.cos(n),f=1-u,d=e[0],l=e[1],c=e[2],p=e[3],g=e[4],y=e[5],m=e[6],_=e[7],b=e[8],M=e[9],x=e[10],w=e[11],v=a*a*f+u,A=i*a*f+t*h,S=t*a*f-i*h,z=a*i*f-t*h,k=i*i*f+u,D=t*i*f+a*h,F=a*t*f+i*h,q=i*t*f-a*h,E=t*t*f+u,r[0]=d*v+g*A+b*S,r[1]=l*v+y*A+M*S,r[2]=c*v+m*A+x*S,r[3]=p*v+_*A+w*S,r[4]=d*z+g*k+b*D,r[5]=l*z+y*k+M*D,r[6]=c*z+m*k+x*D,r[7]=p*z+_*k+w*D,r[8]=d*F+g*q+b*E,r[9]=l*F+y*q+M*E,r[10]=c*F+m*q+x*E,r[11]=p*F+_*q+w*E,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function Je(r,e,n){var s=Math.sin(n),a=Math.cos(n),i=e[4],t=e[5],o=e[6],h=e[7],u=e[8],f=e[9],d=e[10],l=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=i*a+u*s,r[5]=t*a+f*s,r[6]=o*a+d*s,r[7]=h*a+l*s,r[8]=u*a-i*s,r[9]=f*a-t*s,r[10]=d*a-o*s,r[11]=l*a-h*s,r}function rn(r,e,n){var s=Math.sin(n),a=Math.cos(n),i=e[0],t=e[1],o=e[2],h=e[3],u=e[8],f=e[9],d=e[10],l=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*a-u*s,r[1]=t*a-f*s,r[2]=o*a-d*s,r[3]=h*a-l*s,r[8]=i*s+u*a,r[9]=t*s+f*a,r[10]=o*s+d*a,r[11]=h*s+l*a,r}function en(r,e,n){var s=Math.sin(n),a=Math.cos(n),i=e[0],t=e[1],o=e[2],h=e[3],u=e[4],f=e[5],d=e[6],l=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*a+u*s,r[1]=t*a+f*s,r[2]=o*a+d*s,r[3]=h*a+l*s,r[4]=u*a-i*s,r[5]=f*a-t*s,r[6]=d*a-o*s,r[7]=l*a-h*s,r}function nn(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function sn(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function an(r,e,n){var s=n[0],a=n[1],i=n[2],t=Math.hypot(s,a,i),o,h,u;return t<I?null:(t=1/t,s*=t,a*=t,i*=t,o=Math.sin(e),h=Math.cos(e),u=1-h,r[0]=s*s*u+h,r[1]=a*s*u+i*o,r[2]=i*s*u-a*o,r[3]=0,r[4]=s*a*u-i*o,r[5]=a*a*u+h,r[6]=i*a*u+s*o,r[7]=0,r[8]=s*i*u+a*o,r[9]=a*i*u-s*o,r[10]=i*i*u+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function tn(r,e){var n=Math.sin(e),s=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=n,r[7]=0,r[8]=0,r[9]=-n,r[10]=s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function on(r,e){var n=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=0,r[2]=-n,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=n,r[9]=0,r[10]=s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function hn(r,e){var n=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=n,r[2]=0,r[3]=0,r[4]=-n,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ir(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=s+s,h=a+a,u=i+i,f=s*o,d=s*h,l=s*u,c=a*h,p=a*u,g=i*u,y=t*o,m=t*h,_=t*u;return r[0]=1-(c+g),r[1]=d+_,r[2]=l-m,r[3]=0,r[4]=d-_,r[5]=1-(f+g),r[6]=p+y,r[7]=0,r[8]=l+m,r[9]=p-y,r[10]=1-(f+c),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function un(r,e){var n=new L(3),s=-e[0],a=-e[1],i=-e[2],t=e[3],o=e[4],h=e[5],u=e[6],f=e[7],d=s*s+a*a+i*i+t*t;return d>0?(n[0]=(o*t+f*s+h*i-u*a)*2/d,n[1]=(h*t+f*a+u*s-o*i)*2/d,n[2]=(u*t+f*i+o*a-h*s)*2/d):(n[0]=(o*t+f*s+h*i-u*a)*2,n[1]=(h*t+f*a+u*s-o*i)*2,n[2]=(u*t+f*i+o*a-h*s)*2),Ir(r,e,n),r}function ln(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function Dr(r,e){var n=e[0],s=e[1],a=e[2],i=e[4],t=e[5],o=e[6],h=e[8],u=e[9],f=e[10];return r[0]=Math.hypot(n,s,a),r[1]=Math.hypot(i,t,o),r[2]=Math.hypot(h,u,f),r}function cn(r,e){var n=new L(3);Dr(n,e);var s=1/n[0],a=1/n[1],i=1/n[2],t=e[0]*s,o=e[1]*a,h=e[2]*i,u=e[4]*s,f=e[5]*a,d=e[6]*i,l=e[8]*s,c=e[9]*a,p=e[10]*i,g=t+f+p,y=0;return g>0?(y=Math.sqrt(g+1)*2,r[3]=.25*y,r[0]=(d-c)/y,r[1]=(l-h)/y,r[2]=(o-u)/y):t>f&&t>p?(y=Math.sqrt(1+t-f-p)*2,r[3]=(d-c)/y,r[0]=.25*y,r[1]=(o+u)/y,r[2]=(l+h)/y):f>p?(y=Math.sqrt(1+f-t-p)*2,r[3]=(l-h)/y,r[0]=(o+u)/y,r[1]=.25*y,r[2]=(d+c)/y):(y=Math.sqrt(1+p-t-f)*2,r[3]=(o-u)/y,r[0]=(l+h)/y,r[1]=(d+c)/y,r[2]=.25*y),r}function fn(r,e,n,s){var a=e[0],i=e[1],t=e[2],o=e[3],h=a+a,u=i+i,f=t+t,d=a*h,l=a*u,c=a*f,p=i*u,g=i*f,y=t*f,m=o*h,_=o*u,b=o*f,M=s[0],x=s[1],w=s[2];return r[0]=(1-(p+y))*M,r[1]=(l+b)*M,r[2]=(c-_)*M,r[3]=0,r[4]=(l-b)*x,r[5]=(1-(d+y))*x,r[6]=(g+m)*x,r[7]=0,r[8]=(c+_)*w,r[9]=(g-m)*w,r[10]=(1-(d+p))*w,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function pn(r,e,n,s,a){var i=e[0],t=e[1],o=e[2],h=e[3],u=i+i,f=t+t,d=o+o,l=i*u,c=i*f,p=i*d,g=t*f,y=t*d,m=o*d,_=h*u,b=h*f,M=h*d,x=s[0],w=s[1],v=s[2],A=a[0],S=a[1],z=a[2],k=(1-(g+m))*x,D=(c+M)*x,F=(p-b)*x,q=(c-M)*w,E=(1-(l+m))*w,W=(y+_)*w,J=(p+b)*v,gr=(y-_)*v,mr=(1-(l+g))*v;return r[0]=k,r[1]=D,r[2]=F,r[3]=0,r[4]=q,r[5]=E,r[6]=W,r[7]=0,r[8]=J,r[9]=gr,r[10]=mr,r[11]=0,r[12]=n[0]+A-(k*A+q*S+J*z),r[13]=n[1]+S-(D*A+E*S+gr*z),r[14]=n[2]+z-(F*A+W*S+mr*z),r[15]=1,r}function dn(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=n+n,o=s+s,h=a+a,u=n*t,f=s*t,d=s*o,l=a*t,c=a*o,p=a*h,g=i*t,y=i*o,m=i*h;return r[0]=1-d-p,r[1]=f+m,r[2]=l-y,r[3]=0,r[4]=f-m,r[5]=1-u-p,r[6]=c+g,r[7]=0,r[8]=l+y,r[9]=c-g,r[10]=1-u-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function yn(r,e,n,s,a,i,t){var o=1/(n-e),h=1/(a-s),u=1/(i-t);return r[0]=i*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i*2*h,r[6]=0,r[7]=0,r[8]=(n+e)*o,r[9]=(a+s)*h,r[10]=(t+i)*u,r[11]=-1,r[12]=0,r[13]=0,r[14]=t*i*2*u,r[15]=0,r}function Fr(r,e,n,s,a){var i=1/Math.tan(e/2),t;return r[0]=i/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0?(t=1/(s-a),r[10]=(a+s)*t,r[14]=2*a*s*t):(r[10]=-1,r[14]=-2*s),r}var gn=Fr;function mn(r,e,n,s,a){var i=1/Math.tan(e/2),t;return r[0]=i/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0?(t=1/(s-a),r[10]=a*t,r[14]=a*s*t):(r[10]=-1,r[14]=-s),r}function bn(r,e,n,s){var a=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),t=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(t+o),u=2/(a+i);return r[0]=h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=u,r[6]=0,r[7]=0,r[8]=-((t-o)*h*.5),r[9]=(a-i)*u*.5,r[10]=s/(n-s),r[11]=-1,r[12]=0,r[13]=0,r[14]=s*n/(n-s),r[15]=0,r}function Br(r,e,n,s,a,i,t){var o=1/(e-n),h=1/(s-a),u=1/(i-t);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*u,r[11]=0,r[12]=(e+n)*o,r[13]=(a+s)*h,r[14]=(t+i)*u,r[15]=1,r}var _n=Br;function vn(r,e,n,s,a,i,t){var o=1/(e-n),h=1/(s-a),u=1/(i-t);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=u,r[11]=0,r[12]=(e+n)*o,r[13]=(a+s)*h,r[14]=i*u,r[15]=1,r}function Mn(r,e,n,s){var a,i,t,o,h,u,f,d,l,c,p=e[0],g=e[1],y=e[2],m=s[0],_=s[1],b=s[2],M=n[0],x=n[1],w=n[2];return Math.abs(p-M)<I&&Math.abs(g-x)<I&&Math.abs(y-w)<I?Vr(r):(f=p-M,d=g-x,l=y-w,c=1/Math.hypot(f,d,l),f*=c,d*=c,l*=c,a=_*l-b*d,i=b*f-m*l,t=m*d-_*f,c=Math.hypot(a,i,t),c?(c=1/c,a*=c,i*=c,t*=c):(a=0,i=0,t=0),o=d*t-l*i,h=l*a-f*t,u=f*i-d*a,c=Math.hypot(o,h,u),c?(c=1/c,o*=c,h*=c,u*=c):(o=0,h=0,u=0),r[0]=a,r[1]=o,r[2]=f,r[3]=0,r[4]=i,r[5]=h,r[6]=d,r[7]=0,r[8]=t,r[9]=u,r[10]=l,r[11]=0,r[12]=-(a*p+i*g+t*y),r[13]=-(o*p+h*g+u*y),r[14]=-(f*p+d*g+l*y),r[15]=1,r)}function xn(r,e,n,s){var a=e[0],i=e[1],t=e[2],o=s[0],h=s[1],u=s[2],f=a-n[0],d=i-n[1],l=t-n[2],c=f*f+d*d+l*l;c>0&&(c=1/Math.sqrt(c),f*=c,d*=c,l*=c);var p=h*l-u*d,g=u*f-o*l,y=o*d-h*f;return c=p*p+g*g+y*y,c>0&&(c=1/Math.sqrt(c),p*=c,g*=c,y*=c),r[0]=p,r[1]=g,r[2]=y,r[3]=0,r[4]=d*y-l*g,r[5]=l*p-f*y,r[6]=f*g-d*p,r[7]=0,r[8]=f,r[9]=d,r[10]=l,r[11]=0,r[12]=a,r[13]=i,r[14]=t,r[15]=1,r}function wn(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function kn(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function An(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r[4]=e[4]+n[4],r[5]=e[5]+n[5],r[6]=e[6]+n[6],r[7]=e[7]+n[7],r[8]=e[8]+n[8],r[9]=e[9]+n[9],r[10]=e[10]+n[10],r[11]=e[11]+n[11],r[12]=e[12]+n[12],r[13]=e[13]+n[13],r[14]=e[14]+n[14],r[15]=e[15]+n[15],r}function Nr(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r[3]=e[3]-n[3],r[4]=e[4]-n[4],r[5]=e[5]-n[5],r[6]=e[6]-n[6],r[7]=e[7]-n[7],r[8]=e[8]-n[8],r[9]=e[9]-n[9],r[10]=e[10]-n[10],r[11]=e[11]-n[11],r[12]=e[12]-n[12],r[13]=e[13]-n[13],r[14]=e[14]-n[14],r[15]=e[15]-n[15],r}function qn(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*n,r[9]=e[9]*n,r[10]=e[10]*n,r[11]=e[11]*n,r[12]=e[12]*n,r[13]=e[13]*n,r[14]=e[14]*n,r[15]=e[15]*n,r}function zn(r,e,n,s){return r[0]=e[0]+n[0]*s,r[1]=e[1]+n[1]*s,r[2]=e[2]+n[2]*s,r[3]=e[3]+n[3]*s,r[4]=e[4]+n[4]*s,r[5]=e[5]+n[5]*s,r[6]=e[6]+n[6]*s,r[7]=e[7]+n[7]*s,r[8]=e[8]+n[8]*s,r[9]=e[9]+n[9]*s,r[10]=e[10]+n[10]*s,r[11]=e[11]+n[11]*s,r[12]=e[12]+n[12]*s,r[13]=e[13]+n[13]*s,r[14]=e[14]+n[14]*s,r[15]=e[15]+n[15]*s,r}function jn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function Vn(r,e){var n=r[0],s=r[1],a=r[2],i=r[3],t=r[4],o=r[5],h=r[6],u=r[7],f=r[8],d=r[9],l=r[10],c=r[11],p=r[12],g=r[13],y=r[14],m=r[15],_=e[0],b=e[1],M=e[2],x=e[3],w=e[4],v=e[5],A=e[6],S=e[7],z=e[8],k=e[9],D=e[10],F=e[11],q=e[12],E=e[13],W=e[14],J=e[15];return Math.abs(n-_)<=I*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=I*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-M)<=I*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(t-w)<=I*Math.max(1,Math.abs(t),Math.abs(w))&&Math.abs(o-v)<=I*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(h-A)<=I*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-S)<=I*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(f-z)<=I*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(d-k)<=I*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(l-D)<=I*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-F)<=I*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(p-q)<=I*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(g-E)<=I*Math.max(1,Math.abs(g),Math.abs(E))&&Math.abs(y-W)<=I*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(m-J)<=I*Math.max(1,Math.abs(m),Math.abs(J))}var Sn=Sr,In=Nr,fr={};dr(fr,{add:()=>ps,calculateW:()=>ns,clone:()=>us,conjugate:()=>ts,copy:()=>cs,create:()=>pr,dot:()=>Tr,equals:()=>_s,exactEquals:()=>bs,exp:()=>Er,fromEuler:()=>os,fromMat3:()=>$r,fromValues:()=>ls,getAngle:()=>Kn,getAxisAngle:()=>Xn,identity:()=>Zn,invert:()=>is,len:()=>gs,length:()=>Rr,lerp:()=>ys,ln:()=>Or,mul:()=>ds,multiply:()=>Lr,normalize:()=>yr,pow:()=>ss,random:()=>as,rotateX:()=>Jn,rotateY:()=>rs,rotateZ:()=>es,rotationTo:()=>vs,scale:()=>Pr,set:()=>fs,setAxes:()=>xs,setAxisAngle:()=>Cr,slerp:()=>nr,sqlerp:()=>Ms,sqrLen:()=>ms,squaredLength:()=>Gr,str:()=>hs});function Ur(){var r=new L(3);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Dn(r){var e=r[0],n=r[1],s=r[2];return Math.hypot(e,n,s)}function wr(r,e,n){var s=new L(3);return s[0]=r,s[1]=e,s[2]=n,s}function Fn(r,e){var n=e[0],s=e[1],a=e[2],i=n*n+s*s+a*a;return i>0&&(i=1/Math.sqrt(i)),r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function Bn(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function ur(r,e,n){var s=e[0],a=e[1],i=e[2],t=n[0],o=n[1],h=n[2];return r[0]=a*h-i*o,r[1]=i*t-s*h,r[2]=s*o-a*t,r}var Nn=Dn;(function(){var r=Ur();return function(e,n,s,a,i,t){var o,h;for(n||(n=3),s||(s=0),a?h=Math.min(a*n+s,e.length):h=e.length,o=s;o<h;o+=n)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],i(r,r,t),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();function Un(){var r=new L(4);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Cn(r){var e=new L(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Ln(r,e,n,s){var a=new L(4);return a[0]=r,a[1]=e,a[2]=n,a[3]=s,a}function En(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function On(r,e,n,s,a){return r[0]=e,r[1]=n,r[2]=s,r[3]=a,r}function $n(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r[3]=e[3]+n[3],r}function Pn(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function Tn(r){var e=r[0],n=r[1],s=r[2],a=r[3];return Math.hypot(e,n,s,a)}function Rn(r){var e=r[0],n=r[1],s=r[2],a=r[3];return e*e+n*n+s*s+a*a}function Gn(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=n*n+s*s+a*a+i*i;return t>0&&(t=1/Math.sqrt(t)),r[0]=n*t,r[1]=s*t,r[2]=a*t,r[3]=i*t,r}function Hn(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function Wn(r,e,n,s){var a=e[0],i=e[1],t=e[2],o=e[3];return r[0]=a+s*(n[0]-a),r[1]=i+s*(n[1]-i),r[2]=t+s*(n[2]-t),r[3]=o+s*(n[3]-o),r}function Yn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function Qn(r,e){var n=r[0],s=r[1],a=r[2],i=r[3],t=e[0],o=e[1],h=e[2],u=e[3];return Math.abs(n-t)<=I*Math.max(1,Math.abs(n),Math.abs(t))&&Math.abs(s-o)<=I*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(a-h)<=I*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-u)<=I*Math.max(1,Math.abs(i),Math.abs(u))}(function(){var r=Un();return function(e,n,s,a,i,t){var o,h;for(n||(n=4),s||(s=0),a?h=Math.min(a*n+s,e.length):h=e.length,o=s;o<h;o+=n)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],i(r,r,t),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();function pr(){var r=new L(4);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Zn(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Cr(r,e,n){n=n*.5;var s=Math.sin(n);return r[0]=s*e[0],r[1]=s*e[1],r[2]=s*e[2],r[3]=Math.cos(n),r}function Xn(r,e){var n=Math.acos(e[3])*2,s=Math.sin(n/2);return s>I?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),n}function Kn(r,e){var n=Tr(r,e);return Math.acos(2*n*n-1)}function Lr(r,e,n){var s=e[0],a=e[1],i=e[2],t=e[3],o=n[0],h=n[1],u=n[2],f=n[3];return r[0]=s*f+t*o+a*u-i*h,r[1]=a*f+t*h+i*o-s*u,r[2]=i*f+t*u+s*h-a*o,r[3]=t*f-s*o-a*h-i*u,r}function Jn(r,e,n){n*=.5;var s=e[0],a=e[1],i=e[2],t=e[3],o=Math.sin(n),h=Math.cos(n);return r[0]=s*h+t*o,r[1]=a*h+i*o,r[2]=i*h-a*o,r[3]=t*h-s*o,r}function rs(r,e,n){n*=.5;var s=e[0],a=e[1],i=e[2],t=e[3],o=Math.sin(n),h=Math.cos(n);return r[0]=s*h-i*o,r[1]=a*h+t*o,r[2]=i*h+s*o,r[3]=t*h-a*o,r}function es(r,e,n){n*=.5;var s=e[0],a=e[1],i=e[2],t=e[3],o=Math.sin(n),h=Math.cos(n);return r[0]=s*h+a*o,r[1]=a*h-s*o,r[2]=i*h+t*o,r[3]=t*h-i*o,r}function ns(r,e){var n=e[0],s=e[1],a=e[2];return r[0]=n,r[1]=s,r[2]=a,r[3]=Math.sqrt(Math.abs(1-n*n-s*s-a*a)),r}function Er(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=Math.sqrt(n*n+s*s+a*a),o=Math.exp(i),h=t>0?o*Math.sin(t)/t:0;return r[0]=n*h,r[1]=s*h,r[2]=a*h,r[3]=o*Math.cos(t),r}function Or(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=Math.sqrt(n*n+s*s+a*a),o=t>0?Math.atan2(t,i)/t:0;return r[0]=n*o,r[1]=s*o,r[2]=a*o,r[3]=.5*Math.log(n*n+s*s+a*a+i*i),r}function ss(r,e,n){return Or(r,e),Pr(r,r,n),Er(r,r),r}function nr(r,e,n,s){var a=e[0],i=e[1],t=e[2],o=e[3],h=n[0],u=n[1],f=n[2],d=n[3],l,c,p,g,y;return c=a*h+i*u+t*f+o*d,c<0&&(c=-c,h=-h,u=-u,f=-f,d=-d),1-c>I?(l=Math.acos(c),p=Math.sin(l),g=Math.sin((1-s)*l)/p,y=Math.sin(s*l)/p):(g=1-s,y=s),r[0]=g*a+y*h,r[1]=g*i+y*u,r[2]=g*t+y*f,r[3]=g*o+y*d,r}function as(r){var e=hr(),n=hr(),s=hr(),a=Math.sqrt(1-e),i=Math.sqrt(e);return r[0]=a*Math.sin(2*Math.PI*n),r[1]=a*Math.cos(2*Math.PI*n),r[2]=i*Math.sin(2*Math.PI*s),r[3]=i*Math.cos(2*Math.PI*s),r}function is(r,e){var n=e[0],s=e[1],a=e[2],i=e[3],t=n*n+s*s+a*a+i*i,o=t?1/t:0;return r[0]=-n*o,r[1]=-s*o,r[2]=-a*o,r[3]=i*o,r}function ts(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function $r(r,e){var n=e[0]+e[4]+e[8],s;if(n>0)s=Math.sqrt(n+1),r[3]=.5*s,s=.5/s,r[0]=(e[5]-e[7])*s,r[1]=(e[6]-e[2])*s,r[2]=(e[1]-e[3])*s;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var i=(a+1)%3,t=(a+2)%3;s=Math.sqrt(e[a*3+a]-e[i*3+i]-e[t*3+t]+1),r[a]=.5*s,s=.5/s,r[3]=(e[i*3+t]-e[t*3+i])*s,r[i]=(e[i*3+a]+e[a*3+i])*s,r[t]=(e[t*3+a]+e[a*3+t])*s}return r}function os(r,e,n,s){var a=.5*Math.PI/180;e*=a,n*=a,s*=a;var i=Math.sin(e),t=Math.cos(e),o=Math.sin(n),h=Math.cos(n),u=Math.sin(s),f=Math.cos(s);return r[0]=i*h*f-t*o*u,r[1]=t*o*f+i*h*u,r[2]=t*h*u-i*o*f,r[3]=t*h*f+i*o*u,r}function hs(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var us=Cn,ls=Ln,cs=En,fs=On,ps=$n,ds=Lr,Pr=Pn,Tr=Hn,ys=Wn,Rr=Tn,gs=Rr,Gr=Rn,ms=Gr,yr=Gn,bs=Yn,_s=Qn,vs=function(){var r=Ur(),e=wr(1,0,0),n=wr(0,1,0);return function(s,a,i){var t=Bn(a,i);return t<-.999999?(ur(r,e,a),Nn(r)<1e-6&&ur(r,n,a),Fn(r,r),Cr(s,r,Math.PI),s):t>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(ur(r,a,i),s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=1+t,yr(s,s))}}(),Ms=function(){var r=pr(),e=pr();return function(n,s,a,i,t,o){return nr(r,s,t,o),nr(e,a,i,o),nr(n,r,e,2*o*(1-o)),n}}(),xs=function(){var r=qr();return function(e,n,s,a){return r[0]=s[0],r[3]=s[1],r[6]=s[2],r[1]=a[0],r[4]=a[1],r[7]=a[2],r[2]=-n[0],r[5]=-n[1],r[8]=-n[2],yr(e,$r(e,r))}}(),kr={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},Ar=class{constructor(r){this.version="",this._buffer=r}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let r=.28209479177387814,e=this.decoded.color.denormDequant(),n=this.decoded.opacity.denormDequant(),s=(0,X.default)(new Float32Array(e.shape[0]*4),[e.shape[0],4]);return O.mulseq(e,r),O.addseq(e,.5),O.mulseq(e,255),O.maxseq(e,0),O.minseq(e,255),this.version===""&&(O.negeq(n),O.expeq(n),O.addseq(n,1),O.recipeq(n),O.mulseq(n,255)),O.assign(s.hi(e.shape[0],3).lo(0,0),e),O.assign(s.hi(e.shape[0],4).lo(0,3),n),(0,X.default)(new Uint8Array(s.data),[e.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:r,chunkCount:e,chunkSize:n,typeChunks:s,vertexData:a,propertiesDesc:i,version:t}=this.decodeHeader();this.version=t;let o={xyz:i.xyz.compressionMethod,color:i.color.compressionMethod,opacity:i.opacity.compressionMethod,scaling:i.scaling.compressionMethod,quaternion:i.quaternion.compressionMethod,chunkSize:n};i.harmonics_0&&(o.harmonics=i.harmonics_0.compressionMethod);let h=a.byteOffset,u=Array(Object.keys(i).length);for(let m in i)u[i[m].index]={name:m,method:i[m].compressionMethod};let f=e*2*4,d=h,l=s==="dynamic"?e*2:0,c,p=!1;if(l>0){let m=new Uint16Array(a.buffer.slice(d,d+l));d+=l,c=Array.from(m),p=!0}let g={};for(let m of u){let _=0,b=!0;if(m.method==="norm8x")_=r*1*kr[m.name];else if(m.method==="norm11")_=r*4;else if(m.method==="norm565")_=r*2;else throw b=!1,new Error(`Not Implemented format: ${m.method}`);let M;if(b){let v=a.buffer.slice(d,d+f);M=(0,X.default)(new Float32Array(v),[e,2]),d+=f}else throw new Error("loading chunk byt hasnot minmax!");let x=a.buffer.slice(d,d+_);d+=_;let w;if(m.method==="norm8x")w=(0,X.default)(new Uint8Array(x),[r,kr[m.name]]);else if(m.method==="norm11")w=(0,X.default)(new Uint32Array(x));else if(m.method==="norm565")w=(0,X.default)(new Uint16Array(x));else throw new Error(`Not Implemented format: ${m.method}`);g[m.name]=new N(w,M,n,m.method,c,p)}let y=[];for(let m=0;m<15;m++){let _=g[`harmonics_${m}`];_&&(y.push(_),delete g[`harmonics_${m}`])}return y.length>0&&(g.harmonics=y),new lr(o,g.xyz,g.scaling,g.color,g.opacity,g.quaternion,g.harmonics,c)}buildPreComputedBuffers(){let r=this.decoded,e=r.nsplats,n=new ArrayBuffer(24*e),s=new Float32Array(n),a=r.scaling.denormDequant(),i=r.quaternion.denormDequant(),t=fr.create(),o=Q.create(),h=Q.create(),u=Q.create(),f=cr.create();for(let d=0;d<e;d++){cr.fromScaling(f,[Math.exp(a.get(d,0)),Math.exp(a.get(d,1)),Math.exp(a.get(d,2))]),Q.fromMat4(h,f),fr.set(t,i.get(d,0),i.get(d,1),i.get(d,2),i.get(d,3)),Q.fromQuat(o,t),Q.multiply(u,o,h);let l=u;s[6*d]=l[0]*l[0]+l[3]*l[3]+l[6]*l[6],s[6*d+1]=l[0]*l[1]+l[3]*l[4]+l[6]*l[7],s[6*d+2]=l[0]*l[2]+l[3]*l[5]+l[6]*l[8],s[6*d+3]=l[1]*l[1]+l[4]*l[4]+l[7]*l[7],s[6*d+4]=l[1]*l[2]+l[4]*l[5]+l[7]*l[8],s[6*d+5]=l[2]*l[2]+l[5]*l[5]+l[8]*l[8]}this._precomputedCovarianceBufferData=n}decodeHeader(){let r=this._buffer,e=new TextDecoder,n=0,s="",a=100;for(;;){if(n+a>=r.byteLength)throw new Error("End of file reached while searching for end of header");let g=new Uint8Array(r,n,a);s+=e.decode(g),n+=a;let y=n-a*2,m=new Uint8Array(r,Math.max(0,y),y>=0?a*2:a);if(e.decode(m).includes("end_header"))break}let i=s.split(`
`),t=0,o=0,h=0,u=0,f="",d="",l={};for(let g=0;g<i.length;g++){let y=i[g].trim();if(y.startsWith("version"))d=y.split(" ")[1]??"";else if(y.startsWith("element vertex")){let m=y.match(/\d+/);m&&(t=parseInt(m[0]))}else if(y.startsWith("property")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);if(m){let _=m[2],b=m[3];l[_]={compressionMethod:b,index:u},u++}}else if(y.startsWith("element chunks")){let m=y.match(/\d+/);m&&(o=parseInt(m[0]))}else if(y.startsWith("element chunkSize")){let m=y.match(/\d+/);m&&(h=parseInt(m[0]))}else if(y.startsWith("element typeChunks")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);m&&(f=m[3])}else if(y==="end_header")break}let c=s.indexOf("end_header")+10+1,p=new DataView(r,c);return{splatCount:t,chunkCount:o,chunkSize:h,typeChunks:f,vertexData:p,propertiesDesc:l,version:d}}pruneSplats(r){let e=this.decodeBuffer().pruneSplats(r);return Ar.fromCompressedGaussianSplats(e,this.version)}static fromCompressedGaussianSplats(r,e){let n=r.xyz.length,s=r.xyz.nchunks,a=`gspline
version ${e}
element vertex ${n}
element chunks ${s}
element chunkSize ${r.chunkSize}
element typeChunks ${r.isDynamicChunks?"dynamic":"static"}
property xyz ${r.xyz.method}
property color ${r.color.method}
property opacity ${r.opacity.method}
property scaling ${r.scaling.method}
property quaternion ${r.quaternion.method}`;if(r.harmonics&&r.harmonics.length>0)for(let A=0;A<r.harmonics.length;A++)a=`${a}
property harmonics_${A} ${r.harmonics[A].method}`;a=`${a}
end_header
`;let i=new TextEncoder().encode(a),t=s*2*4,o=r.xyz.quantized.data.buffer.byteLength,h=r.xyz instanceof N?t:0,u=r.color.quantized.data.buffer.byteLength,f=r.color instanceof N?t:0,d=r.opacity.quantized.data.buffer.byteLength,l=r.opacity instanceof N?t:0,c=r.scaling.quantized.data.buffer.byteLength,p=r.scaling instanceof N?t:0,g=r.quaternion.quantized.data.buffer.byteLength,y=r.quaternion instanceof N?t:0,m=r.variableChunkSize?Uint16Array.from(r.variableChunkSize):void 0,_=m?m.byteLength:0,b=i.byteLength+_+o+h+u+f+d+l+c+p+g+y,M=0,x=0;if(r.harmonics&&r.harmonics.length>0)for(let A=0;A<r.harmonics.length;A++)M+=r.harmonics[A].quantized.data.buffer.byteLength,x+=r.harmonics[A]instanceof N?t:0;M=0,x=0,b+=M+x;let w=new Uint8Array(b),v=0;if(w.set(i,v),v+=i.byteLength,_>0&&(w.set(new Uint8Array(m.buffer),v),v+=_),r.xyz instanceof N&&(w.set(new Uint8Array(r.xyz.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(r.xyz.quantized.data.buffer),v),v+=o,r.color instanceof N&&(w.set(new Uint8Array(r.color.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(r.color.quantized.data.buffer),v),v+=u,r.opacity instanceof N&&(w.set(new Uint8Array(r.opacity.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(r.opacity.quantized.data.buffer),v),v+=d,r.scaling instanceof N&&(w.set(new Uint8Array(r.scaling.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(r.scaling.quantized.data.buffer),v),v+=c,r.quaternion instanceof N&&(w.set(new Uint8Array(r.quaternion.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(r.quaternion.quantized.data.buffer),v),v+=g,M>0&&r.harmonics&&r.harmonics.length>0)for(let A=0;A<r.harmonics.length;A++){let S=r.harmonics[A];S instanceof N&&(w.set(new Uint8Array(S.minmaxMatrix.data.buffer),v),v+=t),w.set(new Uint8Array(S.quantized.data.buffer),v),v+=S.quantized.data.byteLength}return new Ar(w.buffer)}};export{lr as CompressedGaussianSplats,Ar as GSplineBuffer,Y as GaussianPLYData};
