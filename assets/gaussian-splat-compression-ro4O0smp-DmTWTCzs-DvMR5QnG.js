var Ht=Object.create,et=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,Yt=Object.getOwnPropertyNames,Qt=Object.getPrototypeOf,Zt=Object.prototype.hasOwnProperty,Xt=(t,a,n)=>a in t?et(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,H=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports),dt=(t,a)=>{for(var n in a)et(t,n,{get:a[n],enumerable:!0})},Jt=(t,a,n,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let e of Yt(a))!Zt.call(t,e)&&e!==n&&et(t,e,{get:()=>a[e],enumerable:!(s=Wt(a,e))||s.enumerable});return t},P=(t,a,n)=>(n=t!=null?Ht(Qt(t)):{},Jt(et(n,"default",{value:t,enumerable:!0}),t)),T=(t,a,n)=>(Xt(t,typeof a!="symbol"?a+"":a,n),n),Kt=H((t,a)=>{function n(s){for(var e=new Array(s),i=0;i<s;++i)e[i]=i;return e}a.exports=n}),ta=H((t,a)=>{a.exports=function(e){return e!=null&&(n(e)||s(e)||!!e._isBuffer)};function n(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function s(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&n(e.slice(0,0))}}),tt=H((t,a)=>{var n=Kt(),s=ta(),e=typeof Float64Array<"u";function i(d,l){return d[0]-l[0]}function o(){var d=this.stride,l=new Array(d.length),c;for(c=0;c<l.length;++c)l[c]=[Math.abs(d[c]),c];l.sort(i);var p=new Array(l.length);for(c=0;c<p.length;++c)p[c]=l[c][1];return p}function r(d,l){var c=["View",l,"d",d].join("");l<0&&(c="View_Nil"+d);var p=d==="generic";if(l===-1){var g="function "+c+"(a){this.data=a;};var proto="+c+".prototype;proto.dtype='"+d+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+c+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+c+"(a){return new "+c+"(a);}",z=new Function(g);return z()}else if(l===0){var g="function "+c+"(a,d) {this.data = a;this.offset = d};var proto="+c+".prototype;proto.dtype='"+d+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+c+"_copy() {return new "+c+"(this.data,this.offset)};proto.pick=function "+c+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+c+"_get(){return "+(p?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+c+"_set(v){return "+(p?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+c+"(a,b,c,d){return new "+c+"(a,d)}",z=new Function("TrivialArray",g);return z(u[d][0])}var g=["'use strict'"],y=n(l),m=y.map(function(k){return"i"+k}),_="this.offset+"+y.map(function(k){return"this.stride["+k+"]*i"+k}).join("+"),b=y.map(function(k){return"b"+k}).join(","),M=y.map(function(k){return"c"+k}).join(",");g.push("function "+c+"(a,"+b+","+M+",d){this.data=a","this.shape=["+b+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+c+".prototype","proto.dtype='"+d+"'","proto.dimension="+l),g.push("Object.defineProperty(proto,'size',{get:function "+c+"_size(){return "+y.map(function(k){return"this.shape["+k+"]"}).join("*"),"}})"),l===1?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),l<4?(g.push("function "+c+"_order(){"),l===2?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):l===3&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+c+"_set("+m.join(",")+",v){"),p?g.push("return this.data.set("+_+",v)}"):g.push("return this.data["+_+"]=v}"),g.push("proto.get=function "+c+"_get("+m.join(",")+"){"),p?g.push("return this.data.get("+_+")}"):g.push("return this.data["+_+"]}"),g.push("proto.index=function "+c+"_index(",m.join(),"){return "+_+"}"),g.push("proto.hi=function "+c+"_hi("+m.join(",")+"){return new "+c+"(this.data,"+y.map(function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")}).join(",")+","+y.map(function(k){return"this.stride["+k+"]"}).join(",")+",this.offset)}");var x=y.map(function(k){return"a"+k+"=this.shape["+k+"]"}),w=y.map(function(k){return"c"+k+"=this.stride["+k+"]"});g.push("proto.lo=function "+c+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+w.join(","));for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"c"+k}).join(",")+",b)}"),g.push("proto.step=function "+c+"_step("+m.join(",")+"){var "+y.map(function(k){return"a"+k+"=this.shape["+k+"]"}).join(",")+","+y.map(function(k){return"b"+k+"=this.stride["+k+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"b"+k}).join(",")+",c)}");for(var A=new Array(l),S=new Array(l),v=0;v<l;++v)A[v]="a[i"+v+"]",S[v]="b[i"+v+"]";g.push("proto.transpose=function "+c+"_transpose("+m+"){"+m.map(function(k,I){return k+"=("+k+"===undefined?"+I+":"+k+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+c+"(this.data,"+A.join(",")+","+S.join(",")+",this.offset)}"),g.push("proto.pick=function "+c+"_pick("+m+"){var a=[],b=[],c=this.offset");for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+c+"(data,shape,stride,offset){return new "+c+"(data,"+y.map(function(k){return"shape["+k+"]"}).join(",")+","+y.map(function(k){return"stride["+k+"]"}).join(",")+",offset)}");var z=new Function("CTOR_LIST","ORDER",g.join(`
`));return z(u[d],o)}function h(d){if(s(d))return"buffer";if(e)switch(Object.prototype.toString.call(d)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(d)?"array":"generic"}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function f(d,l,c,p){if(d===void 0){var M=u.array[0];return M([])}else typeof d=="number"&&(d=[d]);l===void 0&&(l=[d.length]);var g=l.length;if(c===void 0){c=new Array(g);for(var y=g-1,m=1;y>=0;--y)c[y]=m,m*=l[y]}if(p===void 0){p=0;for(var y=0;y<g;++y)c[y]<0&&(p-=(l[y]-1)*c[y])}for(var _=h(d),b=u[_];b.length<=g+1;)b.push(r(_,b.length-1));var M=b[g+1];return M(d,l,c,p)}a.exports=f}),aa=H((t,a)=>{function n(i,o){for(var r=1,h=i.length,u=i[0],f=i[0],d=1;d<h;++d)if(f=u,u=i[d],o(u,f)){if(d===r){r++;continue}i[r++]=u}return i.length=r,i}function s(i){for(var o=1,r=i.length,h=i[0],u=i[0],f=1;f<r;++f,u=h)if(u=h,h=i[f],h!==u){if(f===o){o++;continue}i[o++]=h}return i.length=o,i}function e(i,o,r){return i.length===0?i:o?(r||i.sort(o),n(i,o)):(r||i.sort(),s(i))}a.exports=e}),na=H((t,a)=>{var n=aa();function s(u,f,d){var l=u.length,c=f.arrayArgs.length,p=f.indexArgs.length>0,g=[],y=[],m=0,_=0,b,M;for(b=0;b<l;++b)y.push(["i",b,"=0"].join(""));for(M=0;M<c;++M)for(b=0;b<l;++b)_=m,m=u[b],b===0?y.push(["d",M,"s",b,"=t",M,"p",m].join("")):y.push(["d",M,"s",b,"=(t",M,"p",m,"-s",_,"*t",M,"p",_,")"].join(""));for(y.length>0&&g.push("var "+y.join(",")),b=l-1;b>=0;--b)m=u[b],g.push(["for(i",b,"=0;i",b,"<s",m,";++i",b,"){"].join(""));for(g.push(d),b=0;b<l;++b){for(_=m,m=u[b],M=0;M<c;++M)g.push(["p",M,"+=d",M,"s",b].join(""));p&&(b>0&&g.push(["index[",_,"]-=s",_].join("")),g.push(["++index[",m,"]"].join(""))),g.push("}")}return g.join(`
`)}function e(u,f,d,l){for(var c=f.length,p=d.arrayArgs.length,g=d.blockSize,y=d.indexArgs.length>0,m=[],_=0;_<p;++_)m.push(["var offset",_,"=p",_].join(""));for(var _=u;_<c;++_)m.push(["for(var j"+_+"=SS[",f[_],"]|0;j",_,">0;){"].join("")),m.push(["if(j",_,"<",g,"){"].join("")),m.push(["s",f[_],"=j",_].join("")),m.push(["j",_,"=0"].join("")),m.push(["}else{s",f[_],"=",g].join("")),m.push(["j",_,"-=",g,"}"].join("")),y&&m.push(["index[",f[_],"]=j",_].join(""));for(var _=0;_<p;++_){for(var b=["offset"+_],M=u;M<c;++M)b.push(["j",M,"*t",_,"p",f[M]].join(""));m.push(["p",_,"=(",b.join("+"),")"].join(""))}m.push(s(f,d,l));for(var _=u;_<c;++_)m.push("}");return m.join(`
`)}function i(u){for(var f=0,d=u[0].length;f<d;){for(var l=1;l<u.length;++l)if(u[l][f]!==u[0][f])return f;++f}return f}function o(u,f,d){for(var l=u.body,c=[],p=[],g=0;g<u.args.length;++g){var y=u.args[g];if(!(y.count<=0)){var m=new RegExp(y.name,"g"),_="",b=f.arrayArgs.indexOf(g);switch(f.argTypes[g]){case"offset":var M=f.offsetArgIndex.indexOf(g),x=f.offsetArgs[M];b=x.array,_="+q"+M;case"array":_="p"+b+_;var w="l"+g,v="a"+b;if(f.arrayBlockIndices[b]===0)y.count===1?d[b]==="generic"?y.lvalue?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),p.push([v,".set(",_,",",w,")"].join(""))):l=l.replace(m,[v,".get(",_,")"].join("")):l=l.replace(m,[v,"[",_,"]"].join("")):d[b]==="generic"?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),y.lvalue&&p.push([v,".set(",_,",",w,")"].join(""))):(c.push(["var ",w,"=",v,"[",_,"]"].join("")),l=l.replace(m,w),y.lvalue&&p.push([v,"[",_,"]=",w].join("")));else{for(var A=[y.name],S=[_],z=0;z<Math.abs(f.arrayBlockIndices[b]);z++)A.push("\\s*\\[([^\\]]+)\\]"),S.push("$"+(z+1)+"*t"+b+"b"+z);if(m=new RegExp(A.join(""),"g"),_=S.join("+"),d[b]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");l=l.replace(m,[v,"[",_,"]"].join(""))}break;case"scalar":l=l.replace(m,"Y"+f.scalarArgs.indexOf(g));break;case"index":l=l.replace(m,"index");break;case"shape":l=l.replace(m,"shape");break}}}return[c.join(`
`),l,p.join(`
`)].join(`
`).trim()}function r(u){for(var f=new Array(u.length),d=!0,l=0;l<u.length;++l){var c=u[l],p=c.match(/\d+/);p?p=p[0]:p="",c.charAt(0)===0?f[l]="u"+c.charAt(1)+p:f[l]=c.charAt(0)+p,l>0&&(d=d&&f[l]===f[l-1])}return d?f[0]:f.join("")}function h(u,f){for(var d=f[1].length-Math.abs(u.arrayBlockIndices[0])|0,l=new Array(u.arrayArgs.length),c=new Array(u.arrayArgs.length),p=0;p<u.arrayArgs.length;++p)c[p]=f[2*p],l[p]=f[2*p+1];for(var g=[],y=[],m=[],_=[],b=[],p=0;p<u.arrayArgs.length;++p){u.arrayBlockIndices[p]<0?(m.push(0),_.push(d),g.push(d),y.push(d+u.arrayBlockIndices[p])):(m.push(u.arrayBlockIndices[p]),_.push(u.arrayBlockIndices[p]+d),g.push(0),y.push(u.arrayBlockIndices[p]));for(var M=[],x=0;x<l[p].length;x++)m[p]<=l[p][x]&&l[p][x]<_[p]&&M.push(l[p][x]-m[p]);b.push(M)}for(var w=["SS"],v=["'use strict'"],A=[],x=0;x<d;++x)A.push(["s",x,"=SS[",x,"]"].join(""));for(var p=0;p<u.arrayArgs.length;++p){w.push("a"+p),w.push("t"+p),w.push("p"+p);for(var x=0;x<d;++x)A.push(["t",p,"p",x,"=t",p,"[",m[p]+x,"]"].join(""));for(var x=0;x<Math.abs(u.arrayBlockIndices[p]);++x)A.push(["t",p,"b",x,"=t",p,"[",g[p]+x,"]"].join(""))}for(var p=0;p<u.scalarArgs.length;++p)w.push("Y"+p);if(u.shapeArgs.length>0&&A.push("shape=SS.slice(0)"),u.indexArgs.length>0){for(var S=new Array(d),p=0;p<d;++p)S[p]="0";A.push(["index=[",S.join(","),"]"].join(""))}for(var p=0;p<u.offsetArgs.length;++p){for(var z=u.offsetArgs[p],k=[],x=0;x<z.offset.length;++x)z.offset[x]!==0&&(z.offset[x]===1?k.push(["t",z.array,"p",x].join("")):k.push([z.offset[x],"*t",z.array,"p",x].join("")));k.length===0?A.push("q"+p+"=0"):A.push(["q",p,"=",k.join("+")].join(""))}var I=n([].concat(u.pre.thisVars).concat(u.body.thisVars).concat(u.post.thisVars));A=A.concat(I),A.length>0&&v.push("var "+A.join(","));for(var p=0;p<u.arrayArgs.length;++p)v.push("p"+p+"|=0");u.pre.body.length>3&&v.push(o(u.pre,u,c));var F=o(u.body,u,c),q=i(b);q<d?v.push(e(q,b[0],u,F)):v.push(s(b[0],u,F)),u.post.body.length>3&&v.push(o(u.post,u,c)),u.debug&&console.log("-----Generated cwise routine for ",f,`:
`+v.join(`
`)+`
----------`);var E=[u.funcName||"unnamed","_cwise_loop_",l[0].join("s"),"m",q,r(c)].join(""),W=new Function(["function ",E,"(",w.join(","),"){",v.join(`
`),"} return ",E].join(""));return W()}a.exports=h}),sa=H((t,a)=>{var n=na();function s(e){var i=["'use strict'","var CACHED={}"],o=[],r=e.funcName+"_cwise_thunk";i.push(["return function ",r,"(",e.shimArgs.join(","),"){"].join(""));for(var h=[],u=[],f=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],d=[],l=[],c=0;c<e.arrayArgs.length;++c){var p=e.arrayArgs[c];o.push(["t",p,"=array",p,".dtype,","r",p,"=array",p,".order"].join("")),h.push("t"+p),h.push("r"+p),u.push("t"+p),u.push("r"+p+".join()"),f.push("array"+p+".data"),f.push("array"+p+".stride"),f.push("array"+p+".offset|0"),c>0&&(d.push("array"+e.arrayArgs[0]+".shape.length===array"+p+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+p+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}e.arrayArgs.length>1&&(i.push("if (!("+d.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),i.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),i.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),i.push("}"));for(var c=0;c<e.scalarArgs.length;++c)f.push("scalar"+e.scalarArgs[c]);o.push(["type=[",u.join(","),"].join()"].join("")),o.push("proc=CACHED[type]"),i.push("var "+o.join(",")),i.push(["if(!proc){","CACHED[type]=proc=compile([",h.join(","),"])}","return proc(",f.join(","),")}"].join("")),e.debug&&console.log(`-----Generated thunk:
`+i.join(`
`)+`
----------`);var g=new Function("compile",i.join(`
`));return g(n.bind(void 0,e))}a.exports=s}),ea=H((t,a)=>{var n=sa();function s(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function e(i){var o=new s;o.pre=i.pre,o.body=i.body,o.post=i.post;var r=i.args.slice(0);o.argTypes=r;for(var h=0;h<r.length;++h){var u=r[h];if(u==="array"||typeof u=="object"&&u.blockIndices){if(o.argTypes[h]="array",o.arrayArgs.push(h),o.arrayBlockIndices.push(u.blockIndices?u.blockIndices:0),o.shimArgs.push("array"+h),h<o.pre.args.length&&o.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array args");if(h<o.post.args.length&&o.post.args[h].count>0)throw new Error("cwise: post() block may not reference array args")}else if(u==="scalar")o.scalarArgs.push(h),o.shimArgs.push("scalar"+h);else if(u==="index"){if(o.indexArgs.push(h),h<o.pre.args.length&&o.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array index");if(h<o.body.args.length&&o.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array index");if(h<o.post.args.length&&o.post.args[h].count>0)throw new Error("cwise: post() block may not reference array index")}else if(u==="shape"){if(o.shapeArgs.push(h),h<o.pre.args.length&&o.pre.args[h].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(h<o.body.args.length&&o.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array shape");if(h<o.post.args.length&&o.post.args[h].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof u=="object"&&u.offset)o.argTypes[h]="offset",o.offsetArgs.push({array:u.array,offset:u.offset}),o.offsetArgIndex.push(h);else throw new Error("cwise: Unknown argument type "+r[h])}if(o.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(o.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(o.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(o.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return o.debug=!!i.printCode||!!i.debug,o.funcName=i.funcName||"cwise",o.blockSize=i.blockSize||64,n(o)}a.exports=e}),at=H(t=>{var a=ea(),n={body:"",args:[],thisVars:[],localVars:[]};function s(l){if(!l)return n;for(var c=0;c<l.args.length;++c){var p=l.args[c];c===0?l.args[c]={name:p,lvalue:!0,rvalue:!!l.rvalue,count:l.count||1}:l.args[c]={name:p,lvalue:!1,rvalue:!0,count:1}}return l.thisVars||(l.thisVars=[]),l.localVars||(l.localVars=[]),l}function e(l){return a({args:l.args,pre:s(l.pre),body:s(l.body),post:s(l.proc),funcName:l.funcName})}function i(l){for(var c=[],p=0;p<l.args.length;++p)c.push("a"+p);var g=new Function("P",["return function ",l.funcName,"_ndarrayops(",c.join(","),") {P(",c.join(","),");return a0}"].join(""));return g(e(l))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var l in o){var c=o[l];t[l]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),t[l+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+c+"=b"},rvalue:!0,funcName:l+"eq"}),t[l+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),t[l+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+c+"=s"},rvalue:!0,funcName:l+"seq"})}})();var r={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var l in r){var c=r[l];t[l]=i({args:["array","array"],body:{args:["a","b"],body:"a="+c+"b"},funcName:l}),t[l+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+c+"a"},rvalue:!0,count:2,funcName:l+"eq"})}})();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var l in h){var c=h[l];t[l]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),t[l+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),t[l+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+c+"b"},rvalue:!0,count:2,funcName:l+"eq"}),t[l+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+c+"s"},rvalue:!0,count:2,funcName:l+"seq"})}})();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var l=0;l<u.length;++l){var c=u[l];t[c]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:c}),t[c+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"})}})();var f=["max","min","atan2","pow"];(function(){for(var l=0;l<f.length;++l){var c=f[l];t[c]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c}),t[c+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c+"s"}),t[c+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"}),t[c+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"seq"})}})();var d=["atan2","pow"];(function(){for(var l=0;l<d.length;++l){var c=d[l];t[c+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"op"}),t[c+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"ops"}),t[c+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opeq"}),t[c+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opseq"})}})(),t.any=a({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=a({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=a({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=a({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=a({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=a({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=a({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),$=P(tt()),R=P(at()),U=P(tt()),j=P(at()),st=class{constructor(t,a,n){this._dataNormalized=t,this._minD=a,this._maxD=n}static createFromUnnormalized(t){let a=j.sup(t),n=j.inf(t),s=(0,U.default)(new Float32Array(t.size),t.shape),e=a-n;return e<1e-4?j.assigns(s,0):(j.subs(s,t,n),j.divs(s,s,e)),new st(s,n,a)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let t=(0,U.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return j.muls(t,this._dataNormalized,this._maxD-this._minD),j.adds(t,t,this._minD),t}},B=class{constructor(t,a){this._quantized=t,this._method=a}get quantized(){return this._quantized}static maxIntBits(t){return 2**t-1}static fromNormalized(t,a){let n=t.data,s;if(a==="norm8x"){let e=B.maxIntBits(8),i=(0,U.default)(new Float32Array(n.size),n.shape);j.muls(i,n,e),j.roundeq(i),s=(0,U.default)(new Uint8Array(i.data),n.shape)}else if(a==="norm565"){let e=(0,U.default)(new Float32Array(n.size),n.shape);j.assign(e,n),j.mulseq(e.pick(null,0),B.maxIntBits(5)),j.mulseq(e.pick(null,1),B.maxIntBits(6)),j.mulseq(e.pick(null,2),B.maxIntBits(5)),j.roundeq(e);let i=(0,U.default)(new Uint16Array(e.data),n.shape),o=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),r=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);j.lshifts(o,i.pick(null,0),11),j.lshifts(r,i.pick(null,1),5),j.boreq(o,r),j.boreq(o,i.pick(null,2)),s=o}else{let e=(0,U.default)(new Float32Array(n.size),n.shape);j.assign(e,n),j.mulseq(e.pick(null,0),B.maxIntBits(11)),j.mulseq(e.pick(null,1),B.maxIntBits(10)),j.mulseq(e.pick(null,2),B.maxIntBits(11)),j.roundeq(e);let i=(0,U.default)(new Uint32Array(e.data),n.shape),o=(0,U.default)(new Uint32Array(n.shape[0]),[n.shape[0]]),r=(0,U.default)(new Uint32Array(n.shape[0]),[n.shape[0]]);j.lshifts(o,i.pick(null,0),21),j.lshifts(r,i.pick(null,1),11),j.boreq(o,r),j.boreq(o,i.pick(null,2)),s=o}return new B(s,a)}dequantize(t,a){let n=this._method,s,e=this._quantized;if(n==="norm8x"){let i=B.maxIntBits(8);s=(0,U.default)(new Float32Array(e.size),e.shape),j.muls(s,e,1/i)}else if(n==="norm565"){let i=(0,U.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),o=(0,U.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),r=(0,U.default)(new Uint8Array(e.shape[0]),[e.shape[0]]);j.rrshifts(i,e,11),j.rrshifts(o,e,5),j.bandseq(o,B.maxIntBits(6)),j.bands(r,e,B.maxIntBits(5)),s=(0,U.default)(new Float32Array(e.shape[0]*3),[e.shape[0],3]),j.muls(s.pick(null,0),i,1/B.maxIntBits(5)),j.muls(s.pick(null,1),o,1/B.maxIntBits(6)),j.muls(s.pick(null,2),r,1/B.maxIntBits(5))}else{let i=(0,U.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),o=(0,U.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),r=(0,U.default)(new Uint16Array(e.shape[0]),[e.shape[0]]);j.rrshifts(i,e,21),j.rrshifts(o,e,11),j.bandseq(o,B.maxIntBits(10)),j.bands(r,e,B.maxIntBits(11)),s=(0,U.default)(new Float32Array(e.shape[0]*3),[e.shape[0],3]),j.muls(s.pick(null,0),i,1/B.maxIntBits(11)),j.muls(s.pick(null,1),o,1/B.maxIntBits(10)),j.muls(s.pick(null,2),r,1/B.maxIntBits(11))}return new st(s,t,a)}},N=class{constructor(t,a,n,s,e,i=!1){this._quantized=t,this._minMaxMatrix=a,this._chunkSize=n,this._quantizationMethod=s,this._variableChunkSize=e,this._isDynamicChunks=i}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(t){let a=t.length,n=this.minmaxMatrix.shape[0]-a,s=(0,$.default)(new Float32Array(n*2),[n,2]),e=0,i=n,o=0,r=this.minmaxMatrix.shape[0];for(let h=0;h<t.length;h++)r=t[h],i=r-o+e,i>e&&R.assign(s.hi(i,2).lo(e,0),this.minmaxMatrix.hi(r,2).lo(o,0)),e=i,o=r+1;return e<n&&R.assign(s.lo(e,0),this.minmaxMatrix.lo(o,0)),s}_createPrunedQuantized(t){let a=t.length,n=this.quantized.shape[0]-a,s=this._quantizationMethod,e,i;if(s==="norm8x"){i=this._quantized.shape[1];let f=i?n*i:n;e=(0,$.default)(new Uint8Array(f),i?[n,i]:[n,1])}else s==="norm565"?e=(0,$.default)(new Uint16Array(n),[n]):e=(0,$.default)(new Uint32Array(n),[n]);let o=0,r=n,h=0,u=e.shape[0];for(let f=0;f<t.length;f++)u=t[f],r=u-h+o,r>o&&(i?R.assign(e.hi(r,i).lo(o,0),this._quantized.hi(u,i).lo(h,0)):R.assign(e.hi(r).lo(o),this._quantized.hi(u).lo(h))),o=r,h=u+1;return o<n&&(i?R.assign(e.lo(o,0),this._quantized.lo(h,0)):R.assign(e.lo(o),this._quantized.lo(h))),e}pruneFeature(t,a,n){let s=this._createPrunedQuantized(t),e=this._createPrunedMinMax(a);return new N(s,e,this._chunkSize,this._quantizationMethod,n,!0)}static getRequiredNChunks(t,a){return Math.floor(t/a)}static fromArray(t,a,n){let s=t.shape[0],e=Math.floor(s/n),i=(0,$.default)(new Float32Array(e*2),[e,2],[2,1]),o;a==="norm8x"?o=(0,$.default)(new Uint8Array(t.size),t.shape):a==="norm565"?o=(0,$.default)(new Uint16Array(t.shape[0]),[t.shape[0]]):o=(0,$.default)(new Uint32Array(t.shape[0]),[t.shape[0]]);for(let r=0;r<e;r++){let h=r*n,u=r+1<e?(r+1)*n:s,f;t.shape.length>1?f=st.createFromUnnormalized(t.hi(u,t.shape[1]).lo(h,0)):f=st.createFromUnnormalized(t.hi(u).lo(h)),i.set(r,0,f.minD),i.set(r,1,f.maxD),o.shape.length>1?R.assign(o.hi(u,o.shape[1]).lo(h,0),B.fromNormalized(f,a).quantized):R.assign(o.hi(u).lo(h),B.fromNormalized(f,a).quantized)}return new N(o,i,n,a)}denormDequant(){let t=this._minMaxMatrix.shape[0],a=this._quantized,n=a.shape[0],s=this._quantizationMethod,e=this._chunkSize,i;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");i=this._variableChunkSize}let o;s==="norm8x"?o=(0,$.default)(new Float32Array(a.size),a.shape):o=(0,$.default)(new Float32Array(n*3),[n,3]);let r=0,h=e;for(let u=0;u<t;u++){let[f,d]=[this._minMaxMatrix.get(u,0),this._minMaxMatrix.get(u,1)];this._isDynamicChunks&&(h=i[u]);let l=u+1<t?r+h:n,c;a.shape.length>1?c=new B(a.hi(l,a.shape[1]).lo(r,0),s):c=new B(a.hi(l).lo(r),s),R.assign(o.hi(l,o.shape[1]).lo(r,0),c.dequantize(f,d).denormalize()),r=l}return o}static async fetchArrayBuffer(t){return await(await fetch(t,{mode:"cors"})).arrayBuffer()}},G=P(tt()),V=P(at()),ia="http://127.0.0.1:8000",J=P(tt()),C=P(at()),bt=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function _t(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function vt(t,a){if(t===a)return 0;if(~~t===t&&~~a===a){if(t===0||a===0)return t<a?-1:1;if(t<0||a<0){if(a>=0)return-1;if(t>=0)return 1;t=-t,a=-a}let e=_t(t),i=_t(a),o=0;return e<i?(t*=bt[i-e-1],a/=10,o=-1):e>i&&(a*=bt[e-i-1],t/=10,o=1),t===a?o:t<a?-1:1}let n=String(t),s=String(a);return n===s?0:n<s?-1:1}function oa(t){let a=0;for(;t>=32;)a|=t&1,t>>=1;return t+a}function Mt(t,a,n,s){let e=a+1;if(e===n)return 1;if(s(t[e++],t[a])<0){for(;e<n&&s(t[e],t[e-1])<0;)e++;ra(t,a,e)}else for(;e<n&&s(t[e],t[e-1])>=0;)e++;return e-a}function ra(t,a,n){for(n--;a<n;){let s=t[a];t[a++]=t[n],t[n--]=s}}function xt(t,a,n,s,e){for(s===a&&s++;s<n;s++){let i=t[s],o=a,r=s;for(;o<r;){let u=o+r>>>1;e(i,t[u])<0?r=u:o=u+1}let h=s-o;switch(h){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;h>0;)t[o+h]=t[o+h-1],h--}t[o]=i}}function it(t,a,n,s,e,i){let o=0,r=0,h=1;if(i(t,a[n+e])>0){for(r=s-e;h<r&&i(t,a[n+e+h])>0;)o=h,h=(h<<1)+1,h<=0&&(h=r);h>r&&(h=r),o+=e,h+=e}else{for(r=e+1;h<r&&i(t,a[n+e-h])<=0;)o=h,h=(h<<1)+1,h<=0&&(h=r);h>r&&(h=r);let u=o;o=e-h,h=e-u}for(o++;o<h;){let u=o+(h-o>>>1);i(t,a[n+u])>0?o=u+1:h=u}return h}function ot(t,a,n,s,e,i){let o=0,r=0,h=1;if(i(t,a[n+e])<0){for(r=e+1;h<r&&i(t,a[n+e-h])<0;)o=h,h=(h<<1)+1,h<=0&&(h=r);h>r&&(h=r);let u=o;o=e-h,h=e-u}else{for(r=s-e;h<r&&i(t,a[n+e+h])>=0;)o=h,h=(h<<1)+1,h<=0&&(h=r);h>r&&(h=r),o+=e,h+=e}for(o++;o<h;){let u=o+(h-o>>>1);i(t,a[n+u])<0?h=u:o=u+1}return h}var ha=class{constructor(t,a){T(this,"array",null),T(this,"compare",null),T(this,"minGallop",7),T(this,"length",0),T(this,"tmpStorageLength",256),T(this,"stackLength",0),T(this,"runStart",null),T(this,"runLength",null),T(this,"stackSize",0),this.array=t,this.compare=a,this.length=t.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(t,a){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=a,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}}forceMergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}}mergeAt(t){let a=this.compare,n=this.array,s=this.runStart[t],e=this.runLength[t],i=this.runStart[t+1],o=this.runLength[t+1];this.runLength[t]=e+o,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;let r=ot(n[i],n,s,e,0,a);s+=r,e-=r,e!==0&&(o=it(n[s+e-1],n,i,o,o-1,a),o!==0&&(e<=o?this.mergeLow(s,e,i,o):this.mergeHigh(s,e,i,o)))}mergeLow(t,a,n,s){let e=this.compare,i=this.array,o=this.tmp,r=0;for(r=0;r<a;r++)o[r]=i[t+r];let h=0,u=n,f=t;if(i[f++]=i[u++],--s===0){for(r=0;r<a;r++)i[f+r]=o[h+r];return}if(a===1){for(r=0;r<s;r++)i[f+r]=i[u+r];i[f+s]=o[h];return}let d=this.minGallop;for(;;){let l=0,c=0,p=!1;do if(e(i[u],o[h])<0){if(i[f++]=i[u++],c++,l=0,--s===0){p=!0;break}}else if(i[f++]=o[h++],l++,c=0,--a===1){p=!0;break}while((l|c)<d);if(p)break;do{if(l=ot(i[u],o,h,a,0,e),l!==0){for(r=0;r<l;r++)i[f+r]=o[h+r];if(f+=l,h+=l,a-=l,a<=1){p=!0;break}}if(i[f++]=i[u++],--s===0){p=!0;break}if(c=it(o[h],i,u,s,0,e),c!==0){for(r=0;r<c;r++)i[f+r]=i[u+r];if(f+=c,u+=c,s-=c,s===0){p=!0;break}}if(i[f++]=o[h++],--a===1){p=!0;break}d--}while(l>=7||c>=7);if(p)break;d<0&&(d=0),d+=2}if(this.minGallop=d,d<1&&(this.minGallop=1),a===1){for(r=0;r<s;r++)i[f+r]=i[u+r];i[f+s]=o[h]}else{if(a===0)throw new Error("mergeLow preconditions were not respected");for(r=0;r<a;r++)i[f+r]=o[h+r]}}mergeHigh(t,a,n,s){let e=this.compare,i=this.array,o=this.tmp,r=0;for(r=0;r<s;r++)o[r]=i[n+r];let h=t+a-1,u=s-1,f=n+s-1,d=0,l=0;if(i[f--]=i[h--],--a===0){for(d=f-(s-1),r=0;r<s;r++)i[d+r]=o[r];return}if(s===1){for(f-=a,h-=a,l=f+1,d=h+1,r=a-1;r>=0;r--)i[l+r]=i[d+r];i[f]=o[u];return}let c=this.minGallop;for(;;){let p=0,g=0,y=!1;do if(e(o[u],i[h])<0){if(i[f--]=i[h--],p++,g=0,--a===0){y=!0;break}}else if(i[f--]=o[u--],g++,p=0,--s===1){y=!0;break}while((p|g)<c);if(y)break;do{if(p=a-ot(o[u],i,t,a,a-1,e),p!==0){for(f-=p,h-=p,a-=p,l=f+1,d=h+1,r=p-1;r>=0;r--)i[l+r]=i[d+r];if(a===0){y=!0;break}}if(i[f--]=o[u--],--s===1){y=!0;break}if(g=s-it(i[h],o,0,s,s-1,e),g!==0){for(f-=g,u-=g,s-=g,l=f+1,d=u+1,r=0;r<g;r++)i[l+r]=o[d+r];if(s<=1){y=!0;break}}if(i[f--]=i[h--],--a===0){y=!0;break}c--}while(p>=7||g>=7);if(y)break;c<0&&(c=0),c+=2}if(this.minGallop=c,c<1&&(this.minGallop=1),s===1){for(f-=a,h-=a,l=f+1,d=h+1,r=a-1;r>=0;r--)i[l+r]=i[d+r];i[f]=o[u]}else{if(s===0)throw new Error("mergeHigh preconditions were not respected");for(d=f-(s-1),r=0;r<s;r++)i[d+r]=o[r]}}};function ua(t,a,n,s){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");a?typeof a!="function"&&(s=n,n=a,a=vt):a=vt,n||(n=0),s||(s=t.length);let e=s-n;if(e<2)return;let i=0;if(e<32){i=Mt(t,n,s,a),xt(t,n,s,n+i,a);return}let o=new ha(t,a),r=oa(e);do{if(i=Mt(t,n,s,a),i<r){let h=e;h>r&&(h=r),xt(t,n,n+h,n+i,a),i=h}o.pushRun(n,i),o.mergeRuns(),e-=i,n+=i}while(e!==0);o.forceMergeRuns()}function rt(t){let a=(0,J.default)(new Int32Array(t.shape[0]),[t.shape[0]]),n=(0,J.default)(new Int32Array(t.shape[0]),[t.shape[0]]);return C.bands(a,t,1023),C.lshifts(n,a,16),C.bxoreq(a,n),C.bandseq(a,4278190335),C.lshifts(n,a,8),C.bxoreq(a,n),C.bandseq(a,50393103),C.lshifts(n,a,4),C.bxoreq(a,n),C.bandseq(a,51130563),C.lshifts(n,a,2),C.bxoreq(a,n),C.bandseq(a,153391689),a}function la(t){let a=rt(t.pick(null,0)),n=rt(t.pick(null,1));C.lshiftseq(n,1);let s=rt(t.pick(null,2));return C.lshiftseq(s,2),C.boreq(a,n),C.boreq(a,s),a}function Z(t,a){if(t.shape[0]!==a.shape[0])throw new Error("wrong length");let n=(0,J.default)(new Float32Array(t.size),t.shape,t.stride,t.offset);for(let s=0;s<a.shape[0];s++){let e=a.get(s);if(t.shape.length>1)for(let i=0;i<t.shape[1];i++)n.set(s,i,t.get(e,i));else n.set(s,t.get(e))}return n}function ca(t){let a=C.sup(t),n=C.inf(t),s=1e3/Math.min(1e3,a-n),e=(0,J.default)(new Float32Array(t.data),t.shape);C.mulseq(e,s);let i=(0,J.default)(new Int32Array(e.data),t.shape),o=la(i),r=Array.from(o.data).map((u,f)=>[u,f]);ua(r,(u,f)=>u[0]-f[0]);let h=r.map(([u,f])=>f);return(0,J.default)(Uint32Array.from(h))}var Y=class{constructor(t,a,n,s,e,i,o,r,h,u){this.propertyDescs=t,this.format=a,this.nsplats=n,this.xyz=s,this.colors=e,this.harmonics=i,this.opacity=o,this.scaling=r,this.rotation=h,this.maxSHDegree=u}getPlyBinary(){let t=Y._generateHeaderString(this.propertyDescs,this.format,this.nsplats),a=new TextEncoder().encode(t),n=Object.keys(this.propertyDescs).length,s=(0,G.default)(new Float32Array(this.nsplats*n),[this.nsplats,n]);if(V.assign(s.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),V.assign(s.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),V.assign(s.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),V.assign(s.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let o=0;o<this.harmonics.length;o++){let r=o*3;V.assign(s.pick(null,this.propertyDescs[`f_rest_${r}`].index),this.harmonics[o].pick(null,0)),V.assign(s.pick(null,this.propertyDescs[`f_rest_${r+1}`].index),this.harmonics[o].pick(null,1)),V.assign(s.pick(null,this.propertyDescs[`f_rest_${r+2}`].index),this.harmonics[o].pick(null,2))}let e=new Uint8Array(s.data.buffer),i=new Uint8Array(e.length+a.length);return i.set(a),i.set(e,a.length),i.buffer}save(t,a){let n=this.getPlyBinary(),s=new Blob([n],{type:"application/octet-stream"}),e=new File([s],t),i=new FormData;i.append("file",e),i.append("filename",t),i.append("basedir",a),fetch(`${ia}/push_file`,{method:"POST",body:i})}static async loadFile(t){return await(await fetch(t)).arrayBuffer()}mortonPositionSplatsSort(){let t=ca(this.xyz),a=Z(this.xyz,t),n=Z(this.colors,t),s=Z(this.opacity,t),e=Z(this.scaling,t),i=Z(this.rotation,t),o=[];for(let r=0;r<this.harmonics.length;r++)o.push(Z(this.harmonics[r],t));return new Y(this.propertyDescs,this.format,this.nsplats,a,n,o,s,e,i,this.maxSHDegree)}static _generateHeaderString(t,a,n){let s=`ply
format ${a.format} ${a.version}
element vertex ${n}`,e=Object.keys(t).length,i=Array(e);for(let o in t){let r=t[o];i[r.index]={name:o,dtype:r.dtype}}for(let o=0;o<i.length;o++)s=`${s}
property ${i[o].dtype} ${i[o].name}`;return`${s}
end_header
`}static fromArrayBuffer(t,a=3){let{splatCount:n,vertexData:s,propertiesDesc:e,format:i}=Y.decodeHeader(t),o=s.buffer.slice(s.byteOffset),r=Object.keys(e).length,h=(0,G.default)(new Float32Array(o),[n,r]),u=0,f={},d={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let b in e)if(e.hasOwnProperty(b)){let M=e[b].dtype;f[b]=u,u+=d[M]}let l=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(l.pick(null,0),h.pick(null,f.x/4)),V.assign(l.pick(null,1),h.pick(null,f.y/4)),V.assign(l.pick(null,2),h.pick(null,f.z/4));let c=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(c.pick(null,0),h.pick(null,f.scale_0/4)),V.assign(c.pick(null,1),h.pick(null,f.scale_1/4)),V.assign(c.pick(null,2),h.pick(null,f.scale_2/4));let p=(0,G.default)(new Float32Array(n*3),[n,3]);V.assign(p.pick(null,0),h.pick(null,f.f_dc_0/4)),V.assign(p.pick(null,1),h.pick(null,f.f_dc_1/4)),V.assign(p.pick(null,2),h.pick(null,f.f_dc_2/4));let g=(0,G.default)(new Float32Array(n*4),[n,4]);V.assign(g.pick(null,0),h.pick(null,f.rot_1/4)),V.assign(g.pick(null,1),h.pick(null,f.rot_2/4)),V.assign(g.pick(null,2),h.pick(null,f.rot_3/4)),V.assign(g.pick(null,3),h.pick(null,f.rot_0/4));for(let b=0;b<n;b++){let M=g.pick(b,null),x=Math.sqrt(M.get(0)**2+M.get(1)**2+M.get(2)**2+M.get(3)**2);V.divseq(M,x)}let y=(0,G.default)(new Float32Array(n*1),[n,1]);V.assign(y.pick(null,0),h.pick(null,f.opacity/4)),V.negeq(y),V.expeq(y),V.addseq(y,1),V.recipeq(y),V.mulseq(y,255);let m=(Math.min(Math.max(a,0),3)+1)**2-1,_=[];for(let b=0;b<m;b++){let M=(0,G.default)(new Float32Array(n*3),[n,3]),x=b*3;V.assign(M.pick(null,0),h.pick(null,f[`f_rest_${x}`]/4)),V.assign(M.pick(null,1),h.pick(null,f[`f_rest_${x+1}`]/4)),V.assign(M.pick(null,2),h.pick(null,f[`f_rest_${x+2}`]/4)),_.push(M)}return new Y(e,i,n,l,p,_,y,c,g,a)}static async fromPLYFile(t,a=3){let n=await Y.loadFile(t);return Y.fromArrayBuffer(n,a)}static decodeHeader(t){let a=new TextDecoder,n=0,s="",e=100;for(;;){if(n+e>=t.byteLength)throw new Error("End of file reached while searching for end of header");let l=new Uint8Array(t,n,e);s+=a.decode(l),n+=e;let c=n-e*2,p=new Uint8Array(t,Math.max(0,c),c>0?e*2:e);if(a.decode(p).includes("end_header"))break}let i=s.split(`
`),o=0,r={},h=0,u;for(let l=0;l<i.length;l++){let c=i[l].trim();if(c.startsWith("element vertex")){let p=c.match(/\d+/);p&&(o=parseInt(p[0]))}else if(c.startsWith("property")){let p=c.match(/(\w+)\s+(\w+)\s+(\w+)/);if(p){let g=p[2],y=p[3];r[y]={dtype:g,index:h},h++}}else if(c.startsWith("format")){let p=c.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);p&&(u={format:p[2],version:p[3]})}else if(c==="end_header")break}let f=s.indexOf("end_header")+10+1,d=new DataView(t,f);return{splatCount:o,vertexData:d,headerOffset:n,propertiesDesc:r,format:u}}},lt=class{constructor(t,a,n,s,e,i,o,r){this.config=t,this.xyz=a,this.scaling=n,this.color=s,this.opacity=e,this.harmonics=o,this.quaternion=i,this.variableChunkSize=r}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(t,a){let n=N.fromArray(t.xyz,a.xyz,a.chunkSize),s=N.fromArray(t.scaling,a.scaling,a.chunkSize),e=N.fromArray(t.colors,a.color,a.chunkSize),i=N.fromArray(t.opacity,a.opacity,a.chunkSize),o=N.fromArray(t.rotation,a.quaternion,a.chunkSize),r=t.harmonics,h=[];if(a.harmonics)for(let u=0;u<r.length;u++){let f=N.fromArray(r[u],a.harmonics,a.chunkSize);h.push(f)}return new lt(a,n,s,e,i,o,h)}_countIndexesInChunks(t){let a=[],n=this.nchunks,s=this.chunkSize,e=this.nsplats,i=N.getRequiredNChunks(e,s);if(n===i)for(let o=0;o<t.length;o++){let r=t[o],h=Math.floor(r/this.chunkSize);h in a?a[h].push(r):a[h]=[r]}else{let o=this.variableChunkSize,r={},h=0;for(let u=0;u<n;u++)r[u]=h,h+=o[u];for(let u=0;u<t.length;u++){let f=t[u],d=Math.min(Math.floor(f/s),n-1);for(;f>=r[d]+o[d];)d++;d in a?a[d].push(f):a[d]=[f]}}return a}pruneSplats(t){let a=this._countIndexesInChunks(t),n,s=[];return a.length>0&&(n=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),a.forEach((e,i)=>{n[i]-=e.length,n[i]<=0&&s.push(i)}),n=n.filter(e=>e>0)),new lt(this.config,this.xyz.pruneFeature(t,s,n),this.scaling.pruneFeature(t,s,n),this.color.pruneFeature(t,s,n),this.opacity.pruneFeature(t,s,n),this.quaternion.pruneFeature(t,s,n),this.harmonics?this.harmonics.map(e=>e.pruneFeature(t,s,this.variableChunkSize)):void 0,n)}static async loadConfig(t){return await(await fetch(t,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){var t;let a={format:"binary_little_endian",version:"1.0"},n={},s=0;if(n.x={dtype:"float",index:s},s++,n.y={dtype:"float",index:s},s++,n.z={dtype:"float",index:s},s++,n.f_dc_0={dtype:"float",index:s},s++,n.f_dc_1={dtype:"float",index:s},s++,n.f_dc_2={dtype:"float",index:s},s++,this.harmonics&&this.harmonics.length>0)for(let i=0;i<this.harmonics.length;i++)n[`f_rest_${i}`]={dtype:"float",index:s},s++,n[`f_rest_${i+1}`]={dtype:"float",index:s},s++,n[`f_rest_${i+2}`]={dtype:"float",index:s},s++;n.opacity={dtype:"float",index:s},s++,n.scale_0={dtype:"float",index:s},s++,n.scale_1={dtype:"float",index:s},s++,n.scale_2={dtype:"float",index:s},s++,n.rot_0={dtype:"float",index:s},s++,n.rot_1={dtype:"float",index:s},s++,n.rot_2={dtype:"float",index:s},s++,n.rot_3={dtype:"float",index:s},s++;let e=(t=this.harmonics)==null?void 0:t.map(i=>i.denormDequant());return new Y(n,a,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),e||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},X=P(tt()),O=P(at()),D=1e-6,L=typeof Float32Array<"u"?Float32Array:Array,ht=Math.random;Math.hypot||(Math.hypot=function(){for(var t=0,a=arguments.length;a--;)t+=arguments[a]*arguments[a];return Math.sqrt(t)});var Q={};dt(Q,{add:()=>Ba,adjoint:()=>va,clone:()=>pa,copy:()=>da,create:()=>qt,determinant:()=>Ma,equals:()=>La,exactEquals:()=>Ca,frob:()=>Fa,fromMat2d:()=>ja,fromMat4:()=>fa,fromQuat:()=>Va,fromRotation:()=>qa,fromScaling:()=>za,fromTranslation:()=>Aa,fromValues:()=>ya,identity:()=>ma,invert:()=>_a,mul:()=>Ea,multiply:()=>zt,multiplyScalar:()=>Na,multiplyScalarAndAdd:()=>Ua,normalFromMat4:()=>Sa,projection:()=>Da,rotate:()=>wa,scale:()=>ka,set:()=>ga,str:()=>Ia,sub:()=>Oa,subtract:()=>jt,translate:()=>xa,transpose:()=>ba});function qt(){var t=new L(9);return L!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function fa(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t}function pa(t){var a=new L(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a}function da(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}function ya(t,a,n,s,e,i,o,r,h){var u=new L(9);return u[0]=t,u[1]=a,u[2]=n,u[3]=s,u[4]=e,u[5]=i,u[6]=o,u[7]=r,u[8]=h,u}function ga(t,a,n,s,e,i,o,r,h,u){return t[0]=a,t[1]=n,t[2]=s,t[3]=e,t[4]=i,t[5]=o,t[6]=r,t[7]=h,t[8]=u,t}function ma(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ba(t,a){if(t===a){var n=a[1],s=a[2],e=a[5];t[1]=a[3],t[2]=a[6],t[3]=n,t[5]=a[7],t[6]=s,t[7]=e}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t}function _a(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],d=f*o-r*u,l=-f*i+r*h,c=u*i-o*h,p=n*d+s*l+e*c;return p?(p=1/p,t[0]=d*p,t[1]=(-f*s+e*u)*p,t[2]=(r*s-e*o)*p,t[3]=l*p,t[4]=(f*n-e*h)*p,t[5]=(-r*n+e*i)*p,t[6]=c*p,t[7]=(-u*n+s*h)*p,t[8]=(o*n-s*i)*p,t):null}function va(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8];return t[0]=o*f-r*u,t[1]=e*u-s*f,t[2]=s*r-e*o,t[3]=r*h-i*f,t[4]=n*f-e*h,t[5]=e*i-n*r,t[6]=i*u-o*h,t[7]=s*h-n*u,t[8]=n*o-s*i,t}function Ma(t){var a=t[0],n=t[1],s=t[2],e=t[3],i=t[4],o=t[5],r=t[6],h=t[7],u=t[8];return a*(u*i-o*h)+n*(-u*e+o*r)+s*(h*e-i*r)}function zt(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],d=a[8],l=n[0],c=n[1],p=n[2],g=n[3],y=n[4],m=n[5],_=n[6],b=n[7],M=n[8];return t[0]=l*s+c*o+p*u,t[1]=l*e+c*r+p*f,t[2]=l*i+c*h+p*d,t[3]=g*s+y*o+m*u,t[4]=g*e+y*r+m*f,t[5]=g*i+y*h+m*d,t[6]=_*s+b*o+M*u,t[7]=_*e+b*r+M*f,t[8]=_*i+b*h+M*d,t}function xa(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],d=a[8],l=n[0],c=n[1];return t[0]=s,t[1]=e,t[2]=i,t[3]=o,t[4]=r,t[5]=h,t[6]=l*s+c*o+u,t[7]=l*e+c*r+f,t[8]=l*i+c*h+d,t}function wa(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],d=a[8],l=Math.sin(n),c=Math.cos(n);return t[0]=c*s+l*o,t[1]=c*e+l*r,t[2]=c*i+l*h,t[3]=c*o-l*s,t[4]=c*r-l*e,t[5]=c*h-l*i,t[6]=u,t[7]=f,t[8]=d,t}function ka(t,a,n){var s=n[0],e=n[1];return t[0]=s*a[0],t[1]=s*a[1],t[2]=s*a[2],t[3]=e*a[3],t[4]=e*a[4],t[5]=e*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}function Aa(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=a[0],t[7]=a[1],t[8]=1,t}function qa(t,a){var n=Math.sin(a),s=Math.cos(a);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function za(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=a[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function ja(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t}function Va(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=n+n,r=s+s,h=e+e,u=n*o,f=s*o,d=s*r,l=e*o,c=e*r,p=e*h,g=i*o,y=i*r,m=i*h;return t[0]=1-d-p,t[3]=f-m,t[6]=l+y,t[1]=f+m,t[4]=1-u-p,t[7]=c-g,t[2]=l-y,t[5]=c+g,t[8]=1-u-d,t}function Sa(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],d=a[9],l=a[10],c=a[11],p=a[12],g=a[13],y=a[14],m=a[15],_=n*r-s*o,b=n*h-e*o,M=n*u-i*o,x=s*h-e*r,w=s*u-i*r,v=e*u-i*h,A=f*g-d*p,S=f*y-l*p,z=f*m-c*p,k=d*y-l*g,I=d*m-c*g,F=l*m-c*y,q=_*F-b*I+M*k+x*z-w*S+v*A;return q?(q=1/q,t[0]=(r*F-h*I+u*k)*q,t[1]=(h*z-o*F-u*S)*q,t[2]=(o*I-r*z+u*A)*q,t[3]=(e*I-s*F-i*k)*q,t[4]=(n*F-e*z+i*S)*q,t[5]=(s*z-n*I-i*A)*q,t[6]=(g*v-y*w+m*x)*q,t[7]=(y*M-p*v-m*b)*q,t[8]=(p*w-g*M+m*_)*q,t):null}function Da(t,a,n){return t[0]=2/a,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ia(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Fa(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ba(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t[6]=a[6]+n[6],t[7]=a[7]+n[7],t[8]=a[8]+n[8],t}function jt(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t[6]=a[6]-n[6],t[7]=a[7]-n[7],t[8]=a[8]-n[8],t}function Na(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*n,t}function Ua(t,a,n,s){return t[0]=a[0]+n[0]*s,t[1]=a[1]+n[1]*s,t[2]=a[2]+n[2]*s,t[3]=a[3]+n[3]*s,t[4]=a[4]+n[4]*s,t[5]=a[5]+n[5]*s,t[6]=a[6]+n[6]*s,t[7]=a[7]+n[7]*s,t[8]=a[8]+n[8]*s,t}function Ca(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]}function La(t,a){var n=t[0],s=t[1],e=t[2],i=t[3],o=t[4],r=t[5],h=t[6],u=t[7],f=t[8],d=a[0],l=a[1],c=a[2],p=a[3],g=a[4],y=a[5],m=a[6],_=a[7],b=a[8];return Math.abs(n-d)<=D*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-l)<=D*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(e-c)<=D*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(i-p)<=D*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-g)<=D*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(r-y)<=D*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(h-m)<=D*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-_)<=D*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(f-b)<=D*Math.max(1,Math.abs(f),Math.abs(b))}var Ea=zt,Oa=jt,ct={};dt(ct,{add:()=>An,adjoint:()=>Ya,clone:()=>Pa,copy:()=>Ta,create:()=>$a,determinant:()=>Qa,equals:()=>Vn,exactEquals:()=>jn,frob:()=>kn,fromQuat:()=>dn,fromQuat2:()=>un,fromRotation:()=>en,fromRotationTranslation:()=>Dt,fromRotationTranslationScale:()=>fn,fromRotationTranslationScaleOrigin:()=>pn,fromScaling:()=>sn,fromTranslation:()=>nn,fromValues:()=>Ra,fromXRotation:()=>on,fromYRotation:()=>rn,fromZRotation:()=>hn,frustum:()=>yn,getRotation:()=>cn,getScaling:()=>It,getTranslation:()=>ln,identity:()=>Vt,invert:()=>Wa,lookAt:()=>Mn,mul:()=>Sn,multiply:()=>St,multiplyScalar:()=>qn,multiplyScalarAndAdd:()=>zn,ortho:()=>_n,orthoNO:()=>Bt,orthoZO:()=>vn,perspective:()=>gn,perspectiveFromFieldOfView:()=>bn,perspectiveNO:()=>Ft,perspectiveZO:()=>mn,rotate:()=>Ja,rotateX:()=>Ka,rotateY:()=>tn,rotateZ:()=>an,scale:()=>Xa,set:()=>Ga,str:()=>wn,sub:()=>Dn,subtract:()=>Nt,targetTo:()=>xn,translate:()=>Za,transpose:()=>Ha});function $a(){var t=new L(16);return L!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Pa(t){var a=new L(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function Ta(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function Ra(t,a,n,s,e,i,o,r,h,u,f,d,l,c,p,g){var y=new L(16);return y[0]=t,y[1]=a,y[2]=n,y[3]=s,y[4]=e,y[5]=i,y[6]=o,y[7]=r,y[8]=h,y[9]=u,y[10]=f,y[11]=d,y[12]=l,y[13]=c,y[14]=p,y[15]=g,y}function Ga(t,a,n,s,e,i,o,r,h,u,f,d,l,c,p,g,y){return t[0]=a,t[1]=n,t[2]=s,t[3]=e,t[4]=i,t[5]=o,t[6]=r,t[7]=h,t[8]=u,t[9]=f,t[10]=d,t[11]=l,t[12]=c,t[13]=p,t[14]=g,t[15]=y,t}function Vt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ha(t,a){if(t===a){var n=a[1],s=a[2],e=a[3],i=a[6],o=a[7],r=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=n,t[6]=a[9],t[7]=a[13],t[8]=s,t[9]=i,t[11]=a[14],t[12]=e,t[13]=o,t[14]=r}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t}function Wa(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],d=a[9],l=a[10],c=a[11],p=a[12],g=a[13],y=a[14],m=a[15],_=n*r-s*o,b=n*h-e*o,M=n*u-i*o,x=s*h-e*r,w=s*u-i*r,v=e*u-i*h,A=f*g-d*p,S=f*y-l*p,z=f*m-c*p,k=d*y-l*g,I=d*m-c*g,F=l*m-c*y,q=_*F-b*I+M*k+x*z-w*S+v*A;return q?(q=1/q,t[0]=(r*F-h*I+u*k)*q,t[1]=(e*I-s*F-i*k)*q,t[2]=(g*v-y*w+m*x)*q,t[3]=(l*w-d*v-c*x)*q,t[4]=(h*z-o*F-u*S)*q,t[5]=(n*F-e*z+i*S)*q,t[6]=(y*M-p*v-m*b)*q,t[7]=(f*v-l*M+c*b)*q,t[8]=(o*I-r*z+u*A)*q,t[9]=(s*z-n*I-i*A)*q,t[10]=(p*w-g*M+m*_)*q,t[11]=(d*M-f*w-c*_)*q,t[12]=(r*S-o*k-h*A)*q,t[13]=(n*k-s*S+e*A)*q,t[14]=(g*b-p*x-y*_)*q,t[15]=(f*x-d*b+l*_)*q,t):null}function Ya(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],d=a[9],l=a[10],c=a[11],p=a[12],g=a[13],y=a[14],m=a[15];return t[0]=r*(l*m-c*y)-d*(h*m-u*y)+g*(h*c-u*l),t[1]=-(s*(l*m-c*y)-d*(e*m-i*y)+g*(e*c-i*l)),t[2]=s*(h*m-u*y)-r*(e*m-i*y)+g*(e*u-i*h),t[3]=-(s*(h*c-u*l)-r*(e*c-i*l)+d*(e*u-i*h)),t[4]=-(o*(l*m-c*y)-f*(h*m-u*y)+p*(h*c-u*l)),t[5]=n*(l*m-c*y)-f*(e*m-i*y)+p*(e*c-i*l),t[6]=-(n*(h*m-u*y)-o*(e*m-i*y)+p*(e*u-i*h)),t[7]=n*(h*c-u*l)-o*(e*c-i*l)+f*(e*u-i*h),t[8]=o*(d*m-c*g)-f*(r*m-u*g)+p*(r*c-u*d),t[9]=-(n*(d*m-c*g)-f*(s*m-i*g)+p*(s*c-i*d)),t[10]=n*(r*m-u*g)-o*(s*m-i*g)+p*(s*u-i*r),t[11]=-(n*(r*c-u*d)-o*(s*c-i*d)+f*(s*u-i*r)),t[12]=-(o*(d*y-l*g)-f*(r*y-h*g)+p*(r*l-h*d)),t[13]=n*(d*y-l*g)-f*(s*y-e*g)+p*(s*l-e*d),t[14]=-(n*(r*y-h*g)-o*(s*y-e*g)+p*(s*h-e*r)),t[15]=n*(r*l-h*d)-o*(s*l-e*d)+f*(s*h-e*r),t}function Qa(t){var a=t[0],n=t[1],s=t[2],e=t[3],i=t[4],o=t[5],r=t[6],h=t[7],u=t[8],f=t[9],d=t[10],l=t[11],c=t[12],p=t[13],g=t[14],y=t[15],m=a*o-n*i,_=a*r-s*i,b=a*h-e*i,M=n*r-s*o,x=n*h-e*o,w=s*h-e*r,v=u*p-f*c,A=u*g-d*c,S=u*y-l*c,z=f*g-d*p,k=f*y-l*p,I=d*y-l*g;return m*I-_*k+b*z+M*S-x*A+w*v}function St(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],d=a[8],l=a[9],c=a[10],p=a[11],g=a[12],y=a[13],m=a[14],_=a[15],b=n[0],M=n[1],x=n[2],w=n[3];return t[0]=b*s+M*r+x*d+w*g,t[1]=b*e+M*h+x*l+w*y,t[2]=b*i+M*u+x*c+w*m,t[3]=b*o+M*f+x*p+w*_,b=n[4],M=n[5],x=n[6],w=n[7],t[4]=b*s+M*r+x*d+w*g,t[5]=b*e+M*h+x*l+w*y,t[6]=b*i+M*u+x*c+w*m,t[7]=b*o+M*f+x*p+w*_,b=n[8],M=n[9],x=n[10],w=n[11],t[8]=b*s+M*r+x*d+w*g,t[9]=b*e+M*h+x*l+w*y,t[10]=b*i+M*u+x*c+w*m,t[11]=b*o+M*f+x*p+w*_,b=n[12],M=n[13],x=n[14],w=n[15],t[12]=b*s+M*r+x*d+w*g,t[13]=b*e+M*h+x*l+w*y,t[14]=b*i+M*u+x*c+w*m,t[15]=b*o+M*f+x*p+w*_,t}function Za(t,a,n){var s=n[0],e=n[1],i=n[2],o,r,h,u,f,d,l,c,p,g,y,m;return a===t?(t[12]=a[0]*s+a[4]*e+a[8]*i+a[12],t[13]=a[1]*s+a[5]*e+a[9]*i+a[13],t[14]=a[2]*s+a[6]*e+a[10]*i+a[14],t[15]=a[3]*s+a[7]*e+a[11]*i+a[15]):(o=a[0],r=a[1],h=a[2],u=a[3],f=a[4],d=a[5],l=a[6],c=a[7],p=a[8],g=a[9],y=a[10],m=a[11],t[0]=o,t[1]=r,t[2]=h,t[3]=u,t[4]=f,t[5]=d,t[6]=l,t[7]=c,t[8]=p,t[9]=g,t[10]=y,t[11]=m,t[12]=o*s+f*e+p*i+a[12],t[13]=r*s+d*e+g*i+a[13],t[14]=h*s+l*e+y*i+a[14],t[15]=u*s+c*e+m*i+a[15]),t}function Xa(t,a,n){var s=n[0],e=n[1],i=n[2];return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t[4]=a[4]*e,t[5]=a[5]*e,t[6]=a[6]*e,t[7]=a[7]*e,t[8]=a[8]*i,t[9]=a[9]*i,t[10]=a[10]*i,t[11]=a[11]*i,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function Ja(t,a,n,s){var e=s[0],i=s[1],o=s[2],r=Math.hypot(e,i,o),h,u,f,d,l,c,p,g,y,m,_,b,M,x,w,v,A,S,z,k,I,F,q,E;return r<D?null:(r=1/r,e*=r,i*=r,o*=r,h=Math.sin(n),u=Math.cos(n),f=1-u,d=a[0],l=a[1],c=a[2],p=a[3],g=a[4],y=a[5],m=a[6],_=a[7],b=a[8],M=a[9],x=a[10],w=a[11],v=e*e*f+u,A=i*e*f+o*h,S=o*e*f-i*h,z=e*i*f-o*h,k=i*i*f+u,I=o*i*f+e*h,F=e*o*f+i*h,q=i*o*f-e*h,E=o*o*f+u,t[0]=d*v+g*A+b*S,t[1]=l*v+y*A+M*S,t[2]=c*v+m*A+x*S,t[3]=p*v+_*A+w*S,t[4]=d*z+g*k+b*I,t[5]=l*z+y*k+M*I,t[6]=c*z+m*k+x*I,t[7]=p*z+_*k+w*I,t[8]=d*F+g*q+b*E,t[9]=l*F+y*q+M*E,t[10]=c*F+m*q+x*E,t[11]=p*F+_*q+w*E,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)}function Ka(t,a,n){var s=Math.sin(n),e=Math.cos(n),i=a[4],o=a[5],r=a[6],h=a[7],u=a[8],f=a[9],d=a[10],l=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=i*e+u*s,t[5]=o*e+f*s,t[6]=r*e+d*s,t[7]=h*e+l*s,t[8]=u*e-i*s,t[9]=f*e-o*s,t[10]=d*e-r*s,t[11]=l*e-h*s,t}function tn(t,a,n){var s=Math.sin(n),e=Math.cos(n),i=a[0],o=a[1],r=a[2],h=a[3],u=a[8],f=a[9],d=a[10],l=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=i*e-u*s,t[1]=o*e-f*s,t[2]=r*e-d*s,t[3]=h*e-l*s,t[8]=i*s+u*e,t[9]=o*s+f*e,t[10]=r*s+d*e,t[11]=h*s+l*e,t}function an(t,a,n){var s=Math.sin(n),e=Math.cos(n),i=a[0],o=a[1],r=a[2],h=a[3],u=a[4],f=a[5],d=a[6],l=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=i*e+u*s,t[1]=o*e+f*s,t[2]=r*e+d*s,t[3]=h*e+l*s,t[4]=u*e-i*s,t[5]=f*e-o*s,t[6]=d*e-r*s,t[7]=l*e-h*s,t}function nn(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function sn(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function en(t,a,n){var s=n[0],e=n[1],i=n[2],o=Math.hypot(s,e,i),r,h,u;return o<D?null:(o=1/o,s*=o,e*=o,i*=o,r=Math.sin(a),h=Math.cos(a),u=1-h,t[0]=s*s*u+h,t[1]=e*s*u+i*r,t[2]=i*s*u-e*r,t[3]=0,t[4]=s*e*u-i*r,t[5]=e*e*u+h,t[6]=i*e*u+s*r,t[7]=0,t[8]=s*i*u+e*r,t[9]=e*i*u-s*r,t[10]=i*i*u+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function on(t,a){var n=Math.sin(a),s=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rn(t,a){var n=Math.sin(a),s=Math.cos(a);return t[0]=s,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hn(t,a){var n=Math.sin(a),s=Math.cos(a);return t[0]=s,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Dt(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=s+s,h=e+e,u=i+i,f=s*r,d=s*h,l=s*u,c=e*h,p=e*u,g=i*u,y=o*r,m=o*h,_=o*u;return t[0]=1-(c+g),t[1]=d+_,t[2]=l-m,t[3]=0,t[4]=d-_,t[5]=1-(f+g),t[6]=p+y,t[7]=0,t[8]=l+m,t[9]=p-y,t[10]=1-(f+c),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function un(t,a){var n=new L(3),s=-a[0],e=-a[1],i=-a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],d=s*s+e*e+i*i+o*o;return d>0?(n[0]=(r*o+f*s+h*i-u*e)*2/d,n[1]=(h*o+f*e+u*s-r*i)*2/d,n[2]=(u*o+f*i+r*e-h*s)*2/d):(n[0]=(r*o+f*s+h*i-u*e)*2,n[1]=(h*o+f*e+u*s-r*i)*2,n[2]=(u*o+f*i+r*e-h*s)*2),Dt(t,a,n),t}function ln(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t}function It(t,a){var n=a[0],s=a[1],e=a[2],i=a[4],o=a[5],r=a[6],h=a[8],u=a[9],f=a[10];return t[0]=Math.hypot(n,s,e),t[1]=Math.hypot(i,o,r),t[2]=Math.hypot(h,u,f),t}function cn(t,a){var n=new L(3);It(n,a);var s=1/n[0],e=1/n[1],i=1/n[2],o=a[0]*s,r=a[1]*e,h=a[2]*i,u=a[4]*s,f=a[5]*e,d=a[6]*i,l=a[8]*s,c=a[9]*e,p=a[10]*i,g=o+f+p,y=0;return g>0?(y=Math.sqrt(g+1)*2,t[3]=.25*y,t[0]=(d-c)/y,t[1]=(l-h)/y,t[2]=(r-u)/y):o>f&&o>p?(y=Math.sqrt(1+o-f-p)*2,t[3]=(d-c)/y,t[0]=.25*y,t[1]=(r+u)/y,t[2]=(l+h)/y):f>p?(y=Math.sqrt(1+f-o-p)*2,t[3]=(l-h)/y,t[0]=(r+u)/y,t[1]=.25*y,t[2]=(d+c)/y):(y=Math.sqrt(1+p-o-f)*2,t[3]=(r-u)/y,t[0]=(l+h)/y,t[1]=(d+c)/y,t[2]=.25*y),t}function fn(t,a,n,s){var e=a[0],i=a[1],o=a[2],r=a[3],h=e+e,u=i+i,f=o+o,d=e*h,l=e*u,c=e*f,p=i*u,g=i*f,y=o*f,m=r*h,_=r*u,b=r*f,M=s[0],x=s[1],w=s[2];return t[0]=(1-(p+y))*M,t[1]=(l+b)*M,t[2]=(c-_)*M,t[3]=0,t[4]=(l-b)*x,t[5]=(1-(d+y))*x,t[6]=(g+m)*x,t[7]=0,t[8]=(c+_)*w,t[9]=(g-m)*w,t[10]=(1-(d+p))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function pn(t,a,n,s,e){var i=a[0],o=a[1],r=a[2],h=a[3],u=i+i,f=o+o,d=r+r,l=i*u,c=i*f,p=i*d,g=o*f,y=o*d,m=r*d,_=h*u,b=h*f,M=h*d,x=s[0],w=s[1],v=s[2],A=e[0],S=e[1],z=e[2],k=(1-(g+m))*x,I=(c+M)*x,F=(p-b)*x,q=(c-M)*w,E=(1-(l+m))*w,W=(y+_)*w,K=(p+b)*v,gt=(y-_)*v,mt=(1-(l+g))*v;return t[0]=k,t[1]=I,t[2]=F,t[3]=0,t[4]=q,t[5]=E,t[6]=W,t[7]=0,t[8]=K,t[9]=gt,t[10]=mt,t[11]=0,t[12]=n[0]+A-(k*A+q*S+K*z),t[13]=n[1]+S-(I*A+E*S+gt*z),t[14]=n[2]+z-(F*A+W*S+mt*z),t[15]=1,t}function dn(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=n+n,r=s+s,h=e+e,u=n*o,f=s*o,d=s*r,l=e*o,c=e*r,p=e*h,g=i*o,y=i*r,m=i*h;return t[0]=1-d-p,t[1]=f+m,t[2]=l-y,t[3]=0,t[4]=f-m,t[5]=1-u-p,t[6]=c+g,t[7]=0,t[8]=l+y,t[9]=c-g,t[10]=1-u-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yn(t,a,n,s,e,i,o){var r=1/(n-a),h=1/(e-s),u=1/(i-o);return t[0]=i*2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*h,t[6]=0,t[7]=0,t[8]=(n+a)*r,t[9]=(e+s)*h,t[10]=(o+i)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i*2*u,t[15]=0,t}function Ft(t,a,n,s,e){var i=1/Math.tan(a/2),o;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,e!=null&&e!==1/0?(o=1/(s-e),t[10]=(e+s)*o,t[14]=2*e*s*o):(t[10]=-1,t[14]=-2*s),t}var gn=Ft;function mn(t,a,n,s,e){var i=1/Math.tan(a/2),o;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,e!=null&&e!==1/0?(o=1/(s-e),t[10]=e*o,t[14]=e*s*o):(t[10]=-1,t[14]=-s),t}function bn(t,a,n,s){var e=Math.tan(a.upDegrees*Math.PI/180),i=Math.tan(a.downDegrees*Math.PI/180),o=Math.tan(a.leftDegrees*Math.PI/180),r=Math.tan(a.rightDegrees*Math.PI/180),h=2/(o+r),u=2/(e+i);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-r)*h*.5),t[9]=(e-i)*u*.5,t[10]=s/(n-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n/(n-s),t[15]=0,t}function Bt(t,a,n,s,e,i,o){var r=1/(a-n),h=1/(s-e),u=1/(i-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(a+n)*r,t[13]=(e+s)*h,t[14]=(o+i)*u,t[15]=1,t}var _n=Bt;function vn(t,a,n,s,e,i,o){var r=1/(a-n),h=1/(s-e),u=1/(i-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(a+n)*r,t[13]=(e+s)*h,t[14]=i*u,t[15]=1,t}function Mn(t,a,n,s){var e,i,o,r,h,u,f,d,l,c,p=a[0],g=a[1],y=a[2],m=s[0],_=s[1],b=s[2],M=n[0],x=n[1],w=n[2];return Math.abs(p-M)<D&&Math.abs(g-x)<D&&Math.abs(y-w)<D?Vt(t):(f=p-M,d=g-x,l=y-w,c=1/Math.hypot(f,d,l),f*=c,d*=c,l*=c,e=_*l-b*d,i=b*f-m*l,o=m*d-_*f,c=Math.hypot(e,i,o),c?(c=1/c,e*=c,i*=c,o*=c):(e=0,i=0,o=0),r=d*o-l*i,h=l*e-f*o,u=f*i-d*e,c=Math.hypot(r,h,u),c?(c=1/c,r*=c,h*=c,u*=c):(r=0,h=0,u=0),t[0]=e,t[1]=r,t[2]=f,t[3]=0,t[4]=i,t[5]=h,t[6]=d,t[7]=0,t[8]=o,t[9]=u,t[10]=l,t[11]=0,t[12]=-(e*p+i*g+o*y),t[13]=-(r*p+h*g+u*y),t[14]=-(f*p+d*g+l*y),t[15]=1,t)}function xn(t,a,n,s){var e=a[0],i=a[1],o=a[2],r=s[0],h=s[1],u=s[2],f=e-n[0],d=i-n[1],l=o-n[2],c=f*f+d*d+l*l;c>0&&(c=1/Math.sqrt(c),f*=c,d*=c,l*=c);var p=h*l-u*d,g=u*f-r*l,y=r*d-h*f;return c=p*p+g*g+y*y,c>0&&(c=1/Math.sqrt(c),p*=c,g*=c,y*=c),t[0]=p,t[1]=g,t[2]=y,t[3]=0,t[4]=d*y-l*g,t[5]=l*p-f*y,t[6]=f*g-d*p,t[7]=0,t[8]=f,t[9]=d,t[10]=l,t[11]=0,t[12]=e,t[13]=i,t[14]=o,t[15]=1,t}function wn(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function kn(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function An(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t[4]=a[4]+n[4],t[5]=a[5]+n[5],t[6]=a[6]+n[6],t[7]=a[7]+n[7],t[8]=a[8]+n[8],t[9]=a[9]+n[9],t[10]=a[10]+n[10],t[11]=a[11]+n[11],t[12]=a[12]+n[12],t[13]=a[13]+n[13],t[14]=a[14]+n[14],t[15]=a[15]+n[15],t}function Nt(t,a,n){return t[0]=a[0]-n[0],t[1]=a[1]-n[1],t[2]=a[2]-n[2],t[3]=a[3]-n[3],t[4]=a[4]-n[4],t[5]=a[5]-n[5],t[6]=a[6]-n[6],t[7]=a[7]-n[7],t[8]=a[8]-n[8],t[9]=a[9]-n[9],t[10]=a[10]-n[10],t[11]=a[11]-n[11],t[12]=a[12]-n[12],t[13]=a[13]-n[13],t[14]=a[14]-n[14],t[15]=a[15]-n[15],t}function qn(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*n,t[9]=a[9]*n,t[10]=a[10]*n,t[11]=a[11]*n,t[12]=a[12]*n,t[13]=a[13]*n,t[14]=a[14]*n,t[15]=a[15]*n,t}function zn(t,a,n,s){return t[0]=a[0]+n[0]*s,t[1]=a[1]+n[1]*s,t[2]=a[2]+n[2]*s,t[3]=a[3]+n[3]*s,t[4]=a[4]+n[4]*s,t[5]=a[5]+n[5]*s,t[6]=a[6]+n[6]*s,t[7]=a[7]+n[7]*s,t[8]=a[8]+n[8]*s,t[9]=a[9]+n[9]*s,t[10]=a[10]+n[10]*s,t[11]=a[11]+n[11]*s,t[12]=a[12]+n[12]*s,t[13]=a[13]+n[13]*s,t[14]=a[14]+n[14]*s,t[15]=a[15]+n[15]*s,t}function jn(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]}function Vn(t,a){var n=t[0],s=t[1],e=t[2],i=t[3],o=t[4],r=t[5],h=t[6],u=t[7],f=t[8],d=t[9],l=t[10],c=t[11],p=t[12],g=t[13],y=t[14],m=t[15],_=a[0],b=a[1],M=a[2],x=a[3],w=a[4],v=a[5],A=a[6],S=a[7],z=a[8],k=a[9],I=a[10],F=a[11],q=a[12],E=a[13],W=a[14],K=a[15];return Math.abs(n-_)<=D*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=D*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(e-M)<=D*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(i-x)<=D*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-w)<=D*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(r-v)<=D*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(h-A)<=D*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-S)<=D*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(f-z)<=D*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(d-k)<=D*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(l-I)<=D*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-F)<=D*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(p-q)<=D*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(g-E)<=D*Math.max(1,Math.abs(g),Math.abs(E))&&Math.abs(y-W)<=D*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(m-K)<=D*Math.max(1,Math.abs(m),Math.abs(K))}var Sn=St,Dn=Nt,ft={};dt(ft,{add:()=>ps,calculateW:()=>ns,clone:()=>us,conjugate:()=>os,copy:()=>cs,create:()=>pt,dot:()=>Tt,equals:()=>_s,exactEquals:()=>bs,exp:()=>Et,fromEuler:()=>rs,fromMat3:()=>$t,fromValues:()=>ls,getAngle:()=>Jn,getAxisAngle:()=>Xn,identity:()=>Zn,invert:()=>is,len:()=>gs,length:()=>Rt,lerp:()=>ys,ln:()=>Ot,mul:()=>ds,multiply:()=>Lt,normalize:()=>yt,pow:()=>ss,random:()=>es,rotateX:()=>Kn,rotateY:()=>ts,rotateZ:()=>as,rotationTo:()=>vs,scale:()=>Pt,set:()=>fs,setAxes:()=>xs,setAxisAngle:()=>Ct,slerp:()=>nt,sqlerp:()=>Ms,sqrLen:()=>ms,squaredLength:()=>Gt,str:()=>hs});function Ut(){var t=new L(3);return L!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function In(t){var a=t[0],n=t[1],s=t[2];return Math.hypot(a,n,s)}function wt(t,a,n){var s=new L(3);return s[0]=t,s[1]=a,s[2]=n,s}function Fn(t,a){var n=a[0],s=a[1],e=a[2],i=n*n+s*s+e*e;return i>0&&(i=1/Math.sqrt(i)),t[0]=a[0]*i,t[1]=a[1]*i,t[2]=a[2]*i,t}function Bn(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]}function ut(t,a,n){var s=a[0],e=a[1],i=a[2],o=n[0],r=n[1],h=n[2];return t[0]=e*h-i*r,t[1]=i*o-s*h,t[2]=s*r-e*o,t}var Nn=In;(function(){var t=Ut();return function(a,n,s,e,i,o){var r,h;for(n||(n=3),s||(s=0),e?h=Math.min(e*n+s,a.length):h=a.length,r=s;r<h;r+=n)t[0]=a[r],t[1]=a[r+1],t[2]=a[r+2],i(t,t,o),a[r]=t[0],a[r+1]=t[1],a[r+2]=t[2];return a}})();function Un(){var t=new L(4);return L!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Cn(t){var a=new L(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a}function Ln(t,a,n,s){var e=new L(4);return e[0]=t,e[1]=a,e[2]=n,e[3]=s,e}function En(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t}function On(t,a,n,s,e){return t[0]=a,t[1]=n,t[2]=s,t[3]=e,t}function $n(t,a,n){return t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t[3]=a[3]+n[3],t}function Pn(t,a,n){return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t}function Tn(t){var a=t[0],n=t[1],s=t[2],e=t[3];return Math.hypot(a,n,s,e)}function Rn(t){var a=t[0],n=t[1],s=t[2],e=t[3];return a*a+n*n+s*s+e*e}function Gn(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=n*n+s*s+e*e+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=s*o,t[2]=e*o,t[3]=i*o,t}function Hn(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]}function Wn(t,a,n,s){var e=a[0],i=a[1],o=a[2],r=a[3];return t[0]=e+s*(n[0]-e),t[1]=i+s*(n[1]-i),t[2]=o+s*(n[2]-o),t[3]=r+s*(n[3]-r),t}function Yn(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]}function Qn(t,a){var n=t[0],s=t[1],e=t[2],i=t[3],o=a[0],r=a[1],h=a[2],u=a[3];return Math.abs(n-o)<=D*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-r)<=D*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(e-h)<=D*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(i-u)<=D*Math.max(1,Math.abs(i),Math.abs(u))}(function(){var t=Un();return function(a,n,s,e,i,o){var r,h;for(n||(n=4),s||(s=0),e?h=Math.min(e*n+s,a.length):h=a.length,r=s;r<h;r+=n)t[0]=a[r],t[1]=a[r+1],t[2]=a[r+2],t[3]=a[r+3],i(t,t,o),a[r]=t[0],a[r+1]=t[1],a[r+2]=t[2],a[r+3]=t[3];return a}})();function pt(){var t=new L(4);return L!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Zn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ct(t,a,n){n=n*.5;var s=Math.sin(n);return t[0]=s*a[0],t[1]=s*a[1],t[2]=s*a[2],t[3]=Math.cos(n),t}function Xn(t,a){var n=Math.acos(a[3])*2,s=Math.sin(n/2);return s>D?(t[0]=a[0]/s,t[1]=a[1]/s,t[2]=a[2]/s):(t[0]=1,t[1]=0,t[2]=0),n}function Jn(t,a){var n=Tt(t,a);return Math.acos(2*n*n-1)}function Lt(t,a,n){var s=a[0],e=a[1],i=a[2],o=a[3],r=n[0],h=n[1],u=n[2],f=n[3];return t[0]=s*f+o*r+e*u-i*h,t[1]=e*f+o*h+i*r-s*u,t[2]=i*f+o*u+s*h-e*r,t[3]=o*f-s*r-e*h-i*u,t}function Kn(t,a,n){n*=.5;var s=a[0],e=a[1],i=a[2],o=a[3],r=Math.sin(n),h=Math.cos(n);return t[0]=s*h+o*r,t[1]=e*h+i*r,t[2]=i*h-e*r,t[3]=o*h-s*r,t}function ts(t,a,n){n*=.5;var s=a[0],e=a[1],i=a[2],o=a[3],r=Math.sin(n),h=Math.cos(n);return t[0]=s*h-i*r,t[1]=e*h+o*r,t[2]=i*h+s*r,t[3]=o*h-e*r,t}function as(t,a,n){n*=.5;var s=a[0],e=a[1],i=a[2],o=a[3],r=Math.sin(n),h=Math.cos(n);return t[0]=s*h+e*r,t[1]=e*h-s*r,t[2]=i*h+o*r,t[3]=o*h-i*r,t}function ns(t,a){var n=a[0],s=a[1],e=a[2];return t[0]=n,t[1]=s,t[2]=e,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-e*e)),t}function Et(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=Math.sqrt(n*n+s*s+e*e),r=Math.exp(i),h=o>0?r*Math.sin(o)/o:0;return t[0]=n*h,t[1]=s*h,t[2]=e*h,t[3]=r*Math.cos(o),t}function Ot(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=Math.sqrt(n*n+s*s+e*e),r=o>0?Math.atan2(o,i)/o:0;return t[0]=n*r,t[1]=s*r,t[2]=e*r,t[3]=.5*Math.log(n*n+s*s+e*e+i*i),t}function ss(t,a,n){return Ot(t,a),Pt(t,t,n),Et(t,t),t}function nt(t,a,n,s){var e=a[0],i=a[1],o=a[2],r=a[3],h=n[0],u=n[1],f=n[2],d=n[3],l,c,p,g,y;return c=e*h+i*u+o*f+r*d,c<0&&(c=-c,h=-h,u=-u,f=-f,d=-d),1-c>D?(l=Math.acos(c),p=Math.sin(l),g=Math.sin((1-s)*l)/p,y=Math.sin(s*l)/p):(g=1-s,y=s),t[0]=g*e+y*h,t[1]=g*i+y*u,t[2]=g*o+y*f,t[3]=g*r+y*d,t}function es(t){var a=ht(),n=ht(),s=ht(),e=Math.sqrt(1-a),i=Math.sqrt(a);return t[0]=e*Math.sin(2*Math.PI*n),t[1]=e*Math.cos(2*Math.PI*n),t[2]=i*Math.sin(2*Math.PI*s),t[3]=i*Math.cos(2*Math.PI*s),t}function is(t,a){var n=a[0],s=a[1],e=a[2],i=a[3],o=n*n+s*s+e*e+i*i,r=o?1/o:0;return t[0]=-n*r,t[1]=-s*r,t[2]=-e*r,t[3]=i*r,t}function os(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t}function $t(t,a){var n=a[0]+a[4]+a[8],s;if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(a[5]-a[7])*s,t[1]=(a[6]-a[2])*s,t[2]=(a[1]-a[3])*s;else{var e=0;a[4]>a[0]&&(e=1),a[8]>a[e*3+e]&&(e=2);var i=(e+1)%3,o=(e+2)%3;s=Math.sqrt(a[e*3+e]-a[i*3+i]-a[o*3+o]+1),t[e]=.5*s,s=.5/s,t[3]=(a[i*3+o]-a[o*3+i])*s,t[i]=(a[i*3+e]+a[e*3+i])*s,t[o]=(a[o*3+e]+a[e*3+o])*s}return t}function rs(t,a,n,s){var e=.5*Math.PI/180;a*=e,n*=e,s*=e;var i=Math.sin(a),o=Math.cos(a),r=Math.sin(n),h=Math.cos(n),u=Math.sin(s),f=Math.cos(s);return t[0]=i*h*f-o*r*u,t[1]=o*r*f+i*h*u,t[2]=o*h*u-i*r*f,t[3]=o*h*f+i*r*u,t}function hs(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var us=Cn,ls=Ln,cs=En,fs=On,ps=$n,ds=Lt,Pt=Pn,Tt=Hn,ys=Wn,Rt=Tn,gs=Rt,Gt=Rn,ms=Gt,yt=Gn,bs=Yn,_s=Qn,vs=function(){var t=Ut(),a=wt(1,0,0),n=wt(0,1,0);return function(s,e,i){var o=Bn(e,i);return o<-.999999?(ut(t,a,e),Nn(t)<1e-6&&ut(t,n,e),Fn(t,t),Ct(s,t,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(ut(t,e,i),s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1+o,yt(s,s))}}(),Ms=function(){var t=pt(),a=pt();return function(n,s,e,i,o,r){return nt(t,s,o,r),nt(a,e,i,r),nt(n,t,a,2*r*(1-r)),n}}(),xs=function(){var t=qt();return function(a,n,s,e){return t[0]=s[0],t[3]=s[1],t[6]=s[2],t[1]=e[0],t[4]=e[1],t[7]=e[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],yt(a,$t(a,t))}}(),kt={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},At=class{constructor(t){this.version="",this._buffer=t}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let t=.28209479177387814,a=this.decoded.color.denormDequant(),n=this.decoded.opacity.denormDequant(),s=(0,X.default)(new Float32Array(a.shape[0]*4),[a.shape[0],4]);return O.mulseq(a,t),O.addseq(a,.5),O.mulseq(a,255),O.maxseq(a,0),O.minseq(a,255),this.version===""&&(O.negeq(n),O.expeq(n),O.addseq(n,1),O.recipeq(n),O.mulseq(n,255)),O.assign(s.hi(a.shape[0],3).lo(0,0),a),O.assign(s.hi(a.shape[0],4).lo(0,3),n),(0,X.default)(new Uint8Array(s.data),[a.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:t,chunkCount:a,chunkSize:n,typeChunks:s,vertexData:e,propertiesDesc:i,version:o}=this.decodeHeader();this.version=o;let r={xyz:i.xyz.compressionMethod,color:i.color.compressionMethod,opacity:i.opacity.compressionMethod,scaling:i.scaling.compressionMethod,quaternion:i.quaternion.compressionMethod,chunkSize:n};i.harmonics_0&&(r.harmonics=i.harmonics_0.compressionMethod);let h=e.byteOffset,u=Array(Object.keys(i).length);for(let m in i)u[i[m].index]={name:m,method:i[m].compressionMethod};let f=a*2*4,d=h,l=s==="dynamic"?a*2:0,c,p=!1;if(l>0){let m=new Uint16Array(e.buffer.slice(d,d+l));d+=l,c=Array.from(m),p=!0}let g={};for(let m of u){let _=0,b=!0;if(m.method==="norm8x")_=t*1*kt[m.name];else if(m.method==="norm11")_=t*4;else if(m.method==="norm565")_=t*2;else throw b=!1,new Error(`Not Implemented format: ${m.method}`);let M;if(b){let v=e.buffer.slice(d,d+f);M=(0,X.default)(new Float32Array(v),[a,2]),d+=f}else throw new Error("loading chunk byt hasnot minmax!");let x=e.buffer.slice(d,d+_);d+=_;let w;if(m.method==="norm8x")w=(0,X.default)(new Uint8Array(x),[t,kt[m.name]]);else if(m.method==="norm11")w=(0,X.default)(new Uint32Array(x));else if(m.method==="norm565")w=(0,X.default)(new Uint16Array(x));else throw new Error(`Not Implemented format: ${m.method}`);g[m.name]=new N(w,M,n,m.method,c,p)}let y=[];for(let m=0;m<15;m++){let _=g[`harmonics_${m}`];_&&(y.push(_),delete g[`harmonics_${m}`])}return y.length>0&&(g.harmonics=y),new lt(r,g.xyz,g.scaling,g.color,g.opacity,g.quaternion,g.harmonics,c)}buildPreComputedBuffers(){let t=this.decoded,a=t.nsplats,n=new ArrayBuffer(24*a),s=new Float32Array(n),e=t.scaling.denormDequant(),i=t.quaternion.denormDequant(),o=ft.create(),r=Q.create(),h=Q.create(),u=Q.create(),f=ct.create();for(let d=0;d<a;d++){ct.fromScaling(f,[Math.exp(e.get(d,0)),Math.exp(e.get(d,1)),Math.exp(e.get(d,2))]),Q.fromMat4(h,f),ft.set(o,i.get(d,0),i.get(d,1),i.get(d,2),i.get(d,3)),Q.fromQuat(r,o),Q.multiply(u,r,h);let l=u;s[6*d]=l[0]*l[0]+l[3]*l[3]+l[6]*l[6],s[6*d+1]=l[0]*l[1]+l[3]*l[4]+l[6]*l[7],s[6*d+2]=l[0]*l[2]+l[3]*l[5]+l[6]*l[8],s[6*d+3]=l[1]*l[1]+l[4]*l[4]+l[7]*l[7],s[6*d+4]=l[1]*l[2]+l[4]*l[5]+l[7]*l[8],s[6*d+5]=l[2]*l[2]+l[5]*l[5]+l[8]*l[8]}this._precomputedCovarianceBufferData=n}decodeHeader(){let t=this._buffer,a=new TextDecoder,n=0,s="",e=100;for(;;){if(n+e>=t.byteLength)throw new Error("End of file reached while searching for end of header");let g=new Uint8Array(t,n,e);s+=a.decode(g),n+=e;let y=n-e*2,m=new Uint8Array(t,Math.max(0,y),y>=0?e*2:e);if(a.decode(m).includes("end_header"))break}let i=s.split(`
`),o=0,r=0,h=0,u=0,f="",d="",l={};for(let g=0;g<i.length;g++){let y=i[g].trim();if(y.startsWith("version"))d=y.split(" ")[1]??"";else if(y.startsWith("element vertex")){let m=y.match(/\d+/);m&&(o=parseInt(m[0]))}else if(y.startsWith("property")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);if(m){let _=m[2],b=m[3];l[_]={compressionMethod:b,index:u},u++}}else if(y.startsWith("element chunks")){let m=y.match(/\d+/);m&&(r=parseInt(m[0]))}else if(y.startsWith("element chunkSize")){let m=y.match(/\d+/);m&&(h=parseInt(m[0]))}else if(y.startsWith("element typeChunks")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);m&&(f=m[3])}else if(y==="end_header")break}let c=s.indexOf("end_header")+10+1,p=new DataView(t,c);return{splatCount:o,chunkCount:r,chunkSize:h,typeChunks:f,vertexData:p,propertiesDesc:l,version:d}}pruneSplats(t){let a=this.decodeBuffer().pruneSplats(t);return At.fromCompressedGaussianSplats(a,this.version)}static fromCompressedGaussianSplats(t,a){let n=t.xyz.length,s=t.xyz.nchunks,e=`gspline
version ${a}
element vertex ${n}
element chunks ${s}
element chunkSize ${t.chunkSize}
element typeChunks ${t.isDynamicChunks?"dynamic":"static"}
property xyz ${t.xyz.method}
property color ${t.color.method}
property opacity ${t.opacity.method}
property scaling ${t.scaling.method}
property quaternion ${t.quaternion.method}`;if(t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++)e=`${e}
property harmonics_${A} ${t.harmonics[A].method}`;e=`${e}
end_header
`;let i=new TextEncoder().encode(e),o=s*2*4,r=t.xyz.quantized.data.buffer.byteLength,h=t.xyz instanceof N?o:0,u=t.color.quantized.data.buffer.byteLength,f=t.color instanceof N?o:0,d=t.opacity.quantized.data.buffer.byteLength,l=t.opacity instanceof N?o:0,c=t.scaling.quantized.data.buffer.byteLength,p=t.scaling instanceof N?o:0,g=t.quaternion.quantized.data.buffer.byteLength,y=t.quaternion instanceof N?o:0,m=t.variableChunkSize?Uint16Array.from(t.variableChunkSize):void 0,_=m?m.byteLength:0,b=i.byteLength+_+r+h+u+f+d+l+c+p+g+y,M=0,x=0;if(t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++)M+=t.harmonics[A].quantized.data.buffer.byteLength,x+=t.harmonics[A]instanceof N?o:0;M=0,x=0,b+=M+x;let w=new Uint8Array(b),v=0;if(w.set(i,v),v+=i.byteLength,_>0&&(w.set(new Uint8Array(m.buffer),v),v+=_),t.xyz instanceof N&&(w.set(new Uint8Array(t.xyz.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.xyz.quantized.data.buffer),v),v+=r,t.color instanceof N&&(w.set(new Uint8Array(t.color.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.color.quantized.data.buffer),v),v+=u,t.opacity instanceof N&&(w.set(new Uint8Array(t.opacity.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.opacity.quantized.data.buffer),v),v+=d,t.scaling instanceof N&&(w.set(new Uint8Array(t.scaling.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.scaling.quantized.data.buffer),v),v+=c,t.quaternion instanceof N&&(w.set(new Uint8Array(t.quaternion.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.quaternion.quantized.data.buffer),v),v+=g,M>0&&t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++){let S=t.harmonics[A];S instanceof N&&(w.set(new Uint8Array(S.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(S.quantized.data.buffer),v),v+=S.quantized.data.byteLength}return new At(w.buffer)}};export{lt as CompressedGaussianSplats,At as GSplineBuffer,Y as GaussianPLYData};
